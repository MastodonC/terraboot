{
    "version": 1,
    "serial": 2741,
    "remote": {
        "type": "s3",
        "config": {
            "bucket": "terraboot",
            "key": "staging.tf",
            "region": "eu-central-1"
        }
    },
    "modules": [
        {
            "path": [
                "root"
            ],
            "outputs": {},
            "resources": {
                "aws_autoscaling_group.sandpit-staging-masters": {
                    "type": "aws_autoscaling_group",
                    "depends_on": [
                        "aws_elb.sandpit-staging-internal-lb",
                        "aws_elb.sandpit-staging-masters",
                        "aws_launch_configuration.sandpit-staging-masters",
                        "terraform_remote_state.vpc",
                        "terraform_remote_state.vpc"
                    ],
                    "primary": {
                        "id": "sandpit-staging-masters",
                        "attributes": {
                            "availability_zones.#": "2",
                            "availability_zones.1126047633": "eu-central-1a",
                            "availability_zones.3658960427": "eu-central-1b",
                            "default_cooldown": "300",
                            "desired_capacity": "3",
                            "force_delete": "false",
                            "health_check_grace_period": "20",
                            "health_check_type": "EC2",
                            "id": "sandpit-staging-masters",
                            "launch_configuration": "sandpit-staging-masters-wzsm2cpd4zb7pcs2co4ra2cahe",
                            "load_balancers.#": "2",
                            "load_balancers.2095926242": "sandpit-staging-internal-lb",
                            "load_balancers.3562399459": "sandpit-staging-masters",
                            "max_size": "3",
                            "metrics_granularity": "1Minute",
                            "min_size": "3",
                            "name": "sandpit-staging-masters",
                            "placement_group": "",
                            "tag.#": "1",
                            "tag.189038654.key": "Name",
                            "tag.189038654.propagate_at_launch": "true",
                            "tag.189038654.value": "autoscale-masters",
                            "termination_policies.#": "0",
                            "vpc_zone_identifier.#": "2",
                            "vpc_zone_identifier.2163134521": "subnet-6583d00c",
                            "vpc_zone_identifier.3416228750": "subnet-af5127d4",
                            "wait_for_capacity_timeout": "10m"
                        }
                    }
                },
                "aws_autoscaling_group.sandpit-staging-public-slaves": {
                    "type": "aws_autoscaling_group",
                    "depends_on": [
                        "aws_elb.sandpit-staging-public-slaves",
                        "aws_launch_configuration.sandpit-staging-public-slaves",
                        "terraform_remote_state.vpc",
                        "terraform_remote_state.vpc"
                    ],
                    "primary": {
                        "id": "sandpit-staging-public-slaves",
                        "attributes": {
                            "availability_zones.#": "2",
                            "availability_zones.1126047633": "eu-central-1a",
                            "availability_zones.3658960427": "eu-central-1b",
                            "default_cooldown": "300",
                            "desired_capacity": "1",
                            "force_delete": "false",
                            "health_check_grace_period": "20",
                            "health_check_type": "EC2",
                            "id": "sandpit-staging-public-slaves",
                            "launch_configuration": "sandpit-staging-public-slaves-uzcdcxzuxnhyta3lbggxniisgm",
                            "load_balancers.#": "1",
                            "load_balancers.2704989236": "sandpit-staging-public-slaves",
                            "max_size": "1",
                            "metrics_granularity": "1Minute",
                            "min_size": "1",
                            "name": "sandpit-staging-public-slaves",
                            "placement_group": "",
                            "tag.#": "1",
                            "tag.1363845656.key": "Name",
                            "tag.1363845656.propagate_at_launch": "true",
                            "tag.1363845656.value": "autoscale-public-slaves",
                            "termination_policies.#": "0",
                            "vpc_zone_identifier.#": "2",
                            "vpc_zone_identifier.2163134521": "subnet-6583d00c",
                            "vpc_zone_identifier.3416228750": "subnet-af5127d4",
                            "wait_for_capacity_timeout": "10m"
                        }
                    }
                },
                "aws_autoscaling_group.sandpit-staging-slaves": {
                    "type": "aws_autoscaling_group",
                    "depends_on": [
                        "aws_launch_configuration.sandpit-staging-slaves",
                        "terraform_remote_state.vpc",
                        "terraform_remote_state.vpc"
                    ],
                    "primary": {
                        "id": "sandpit-staging-slaves",
                        "attributes": {
                            "availability_zones.#": "2",
                            "availability_zones.1126047633": "eu-central-1a",
                            "availability_zones.3658960427": "eu-central-1b",
                            "default_cooldown": "300",
                            "desired_capacity": "2",
                            "force_delete": "false",
                            "health_check_grace_period": "20",
                            "health_check_type": "EC2",
                            "id": "sandpit-staging-slaves",
                            "launch_configuration": "sandpit-staging-slaves-5kopy475h5anddfrfc53ajvbwy",
                            "load_balancers.#": "0",
                            "max_size": "2",
                            "metrics_granularity": "1Minute",
                            "min_size": "2",
                            "name": "sandpit-staging-slaves",
                            "placement_group": "",
                            "tag.#": "1",
                            "tag.70531153.key": "Name",
                            "tag.70531153.propagate_at_launch": "true",
                            "tag.70531153.value": "autoscale-slaves",
                            "termination_policies.#": "0",
                            "vpc_zone_identifier.#": "2",
                            "vpc_zone_identifier.638682311": "subnet-a85127d3",
                            "vpc_zone_identifier.844029473": "subnet-6283d00b",
                            "wait_for_capacity_timeout": "10m"
                        }
                    }
                },
                "aws_elb.sandpit-staging-internal-lb": {
                    "type": "aws_elb",
                    "depends_on": [
                        "aws_security_group.sandpit-staging-admin-security-group",
                        "aws_security_group.sandpit-staging-lb-security-group",
                        "aws_security_group.sandpit-staging-master-security-group",
                        "terraform_remote_state.vpc",
                        "terraform_remote_state.vpc",
                        "terraform_remote_state.vpc"
                    ],
                    "primary": {
                        "id": "sandpit-staging-internal-lb",
                        "attributes": {
                            "access_logs.#": "0",
                            "availability_zones.#": "2",
                            "availability_zones.1126047633": "eu-central-1a",
                            "availability_zones.3658960427": "eu-central-1b",
                            "connection_draining": "true",
                            "connection_draining_timeout": "60",
                            "cross_zone_load_balancing": "true",
                            "dns_name": "internal-sandpit-staging-internal-lb-1023536621.eu-central-1.elb.amazonaws.com",
                            "health_check.#": "1",
                            "health_check.0.healthy_threshold": "2",
                            "health_check.0.interval": "30",
                            "health_check.0.target": "HTTP:8181/exhibitor/v1/cluster/status",
                            "health_check.0.timeout": "5",
                            "health_check.0.unhealthy_threshold": "3",
                            "id": "sandpit-staging-internal-lb",
                            "idle_timeout": "60",
                            "instances.#": "3",
                            "instances.1777489198": "i-f83ba744",
                            "instances.3095555596": "i-f93ba745",
                            "instances.472116417": "i-2367c09e",
                            "internal": "true",
                            "listener.#": "6",
                            "listener.1092403652.instance_port": "8080",
                            "listener.1092403652.instance_protocol": "http",
                            "listener.1092403652.lb_port": "8080",
                            "listener.1092403652.lb_protocol": "http",
                            "listener.1092403652.ssl_certificate_id": "",
                            "listener.2024497952.instance_port": "2181",
                            "listener.2024497952.instance_protocol": "tcp",
                            "listener.2024497952.lb_port": "2181",
                            "listener.2024497952.lb_protocol": "tcp",
                            "listener.2024497952.ssl_certificate_id": "",
                            "listener.2613737617.instance_port": "53",
                            "listener.2613737617.instance_protocol": "tcp",
                            "listener.2613737617.lb_port": "53",
                            "listener.2613737617.lb_protocol": "tcp",
                            "listener.2613737617.ssl_certificate_id": "",
                            "listener.3057123346.instance_port": "80",
                            "listener.3057123346.instance_protocol": "http",
                            "listener.3057123346.lb_port": "80",
                            "listener.3057123346.lb_protocol": "http",
                            "listener.3057123346.ssl_certificate_id": "",
                            "listener.3829233144.instance_port": "5050",
                            "listener.3829233144.instance_protocol": "http",
                            "listener.3829233144.lb_port": "5050",
                            "listener.3829233144.lb_protocol": "http",
                            "listener.3829233144.ssl_certificate_id": "",
                            "listener.3896584131.instance_port": "8181",
                            "listener.3896584131.instance_protocol": "http",
                            "listener.3896584131.lb_port": "8181",
                            "listener.3896584131.lb_protocol": "http",
                            "listener.3896584131.ssl_certificate_id": "",
                            "name": "sandpit-staging-internal-lb",
                            "security_groups.#": "4",
                            "security_groups.1489236821": "sg-2579634c",
                            "security_groups.2578033345": "sg-a06e63c9",
                            "security_groups.3932421453": "sg-2279634b",
                            "security_groups.423697735": "sg-2679634f",
                            "source_security_group": "165664414043/sandpit-staging-lb-security-group",
                            "source_security_group_id": "sg-2279634b",
                            "subnets.#": "2",
                            "subnets.2163134521": "subnet-6583d00c",
                            "subnets.3416228750": "subnet-af5127d4",
                            "tags.#": "1",
                            "tags.Name": "sandpit-staging-internal-lb",
                            "zone_id": "Z215JYRZR1TBD5"
                        }
                    }
                },
                "aws_elb.sandpit-staging-masters": {
                    "type": "aws_elb",
                    "depends_on": [
                        "aws_security_group.sandpit-staging-admin-security-group",
                        "aws_security_group.sandpit-staging-lb-security-group",
                        "terraform_remote_state.vpc",
                        "terraform_remote_state.vpc",
                        "terraform_remote_state.vpc"
                    ],
                    "primary": {
                        "id": "sandpit-staging-masters",
                        "attributes": {
                            "access_logs.#": "0",
                            "availability_zones.#": "2",
                            "availability_zones.1126047633": "eu-central-1a",
                            "availability_zones.3658960427": "eu-central-1b",
                            "connection_draining": "true",
                            "connection_draining_timeout": "60",
                            "cross_zone_load_balancing": "true",
                            "dns_name": "sandpit-staging-masters-795347527.eu-central-1.elb.amazonaws.com",
                            "health_check.#": "1",
                            "health_check.0.healthy_threshold": "2",
                            "health_check.0.interval": "30",
                            "health_check.0.target": "HTTP:5050/health",
                            "health_check.0.timeout": "5",
                            "health_check.0.unhealthy_threshold": "3",
                            "id": "sandpit-staging-masters",
                            "idle_timeout": "60",
                            "instances.#": "3",
                            "instances.1777489198": "i-f83ba744",
                            "instances.3095555596": "i-f93ba745",
                            "instances.472116417": "i-2367c09e",
                            "internal": "false",
                            "listener.#": "2",
                            "listener.1082590633.instance_port": "80",
                            "listener.1082590633.instance_protocol": "http",
                            "listener.1082590633.lb_port": "443",
                            "listener.1082590633.lb_protocol": "https",
                            "listener.1082590633.ssl_certificate_id": "arn:aws:iam::165664414043:server-certificate/StartMastodoncNet",
                            "listener.3057123346.instance_port": "80",
                            "listener.3057123346.instance_protocol": "http",
                            "listener.3057123346.lb_port": "80",
                            "listener.3057123346.lb_protocol": "http",
                            "listener.3057123346.ssl_certificate_id": "",
                            "name": "sandpit-staging-masters",
                            "security_groups.#": "3",
                            "security_groups.2578033345": "sg-a06e63c9",
                            "security_groups.3932421453": "sg-2279634b",
                            "security_groups.423697735": "sg-2679634f",
                            "source_security_group": "165664414043/sandpit-staging-lb-security-group",
                            "source_security_group_id": "sg-2279634b",
                            "subnets.#": "2",
                            "subnets.2163134521": "subnet-6583d00c",
                            "subnets.3416228750": "subnet-af5127d4",
                            "tags.#": "1",
                            "tags.Name": "sandpit-staging-masters",
                            "zone_id": "Z215JYRZR1TBD5"
                        }
                    }
                },
                "aws_elb.sandpit-staging-public-slaves": {
                    "type": "aws_elb",
                    "depends_on": [
                        "aws_security_group.sandpit-staging-public-slave-security-group",
                        "terraform_remote_state.vpc",
                        "terraform_remote_state.vpc",
                        "terraform_remote_state.vpc"
                    ],
                    "primary": {
                        "id": "sandpit-staging-public-slaves",
                        "attributes": {
                            "access_logs.#": "0",
                            "availability_zones.#": "2",
                            "availability_zones.1126047633": "eu-central-1a",
                            "availability_zones.3658960427": "eu-central-1b",
                            "connection_draining": "true",
                            "connection_draining_timeout": "60",
                            "cross_zone_load_balancing": "true",
                            "dns_name": "sandpit-staging-public-slaves-1802906586.eu-central-1.elb.amazonaws.com",
                            "health_check.#": "1",
                            "health_check.0.healthy_threshold": "2",
                            "health_check.0.interval": "30",
                            "health_check.0.target": "HTTP:80/",
                            "health_check.0.timeout": "5",
                            "health_check.0.unhealthy_threshold": "2",
                            "id": "sandpit-staging-public-slaves",
                            "idle_timeout": "60",
                            "instances.#": "1",
                            "instances.1806574656": "i-31e7408c",
                            "internal": "false",
                            "listener.#": "2",
                            "listener.1131056931.instance_port": "9501",
                            "listener.1131056931.instance_protocol": "http",
                            "listener.1131056931.lb_port": "9501",
                            "listener.1131056931.lb_protocol": "http",
                            "listener.1131056931.ssl_certificate_id": "",
                            "listener.3057123346.instance_port": "80",
                            "listener.3057123346.instance_protocol": "http",
                            "listener.3057123346.lb_port": "80",
                            "listener.3057123346.lb_protocol": "http",
                            "listener.3057123346.ssl_certificate_id": "",
                            "name": "sandpit-staging-public-slaves",
                            "security_groups.#": "2",
                            "security_groups.2578033345": "sg-a06e63c9",
                            "security_groups.641681225": "sg-2779634e",
                            "source_security_group": "165664414043/sandpit-staging-public-slave-security-group",
                            "source_security_group_id": "sg-2779634e",
                            "subnets.#": "2",
                            "subnets.2163134521": "subnet-6583d00c",
                            "subnets.3416228750": "subnet-af5127d4",
                            "tags.#": "1",
                            "tags.Name": "sandpit-staging-public-slaves",
                            "zone_id": "Z215JYRZR1TBD5"
                        }
                    }
                },
                "aws_iam_access_key.sandpit-staging-host-key": {
                    "type": "aws_iam_access_key",
                    "depends_on": [
                        "aws_iam_user.sandpit-staging-mesos-user"
                    ],
                    "primary": {
                        "id": "AKIAIU6KU4KHLAG5KWLA",
                        "attributes": {
                            "id": "AKIAIU6KU4KHLAG5KWLA",
                            "secret": "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",
                            "ses_smtp_password": "Ai3Sann3Yl41umaEq7lKGAzfyNSmR87ve36xR/CJ0GLc",
                            "status": "Inactive",
                            "user": "sandpit-staging-mesos-user"
                        }
                    }
                },
                "aws_iam_instance_profile.sandpit-staging-masters": {
                    "type": "aws_iam_instance_profile",
                    "depends_on": [
                        "aws_iam_role.sandpit-staging-master-role"
                    ],
                    "primary": {
                        "id": "sandpit-staging-masters-profile",
                        "attributes": {
                            "arn": "arn:aws:iam::165664414043:instance-profile/sandpit-staging-masters-profile",
                            "id": "sandpit-staging-masters-profile",
                            "name": "sandpit-staging-masters-profile",
                            "path": "/",
                            "roles.#": "1",
                            "roles.4288480984": "sandpit-staging-master-role"
                        }
                    }
                },
                "aws_iam_instance_profile.sandpit-staging-public-slaves": {
                    "type": "aws_iam_instance_profile",
                    "depends_on": [
                        "aws_iam_role.sandpit-staging-slave-role"
                    ],
                    "primary": {
                        "id": "sandpit-staging-public-slaves-profile",
                        "attributes": {
                            "arn": "arn:aws:iam::165664414043:instance-profile/sandpit-staging-public-slaves-profile",
                            "id": "sandpit-staging-public-slaves-profile",
                            "name": "sandpit-staging-public-slaves-profile",
                            "path": "/",
                            "roles.#": "1",
                            "roles.2467116355": "sandpit-staging-slave-role"
                        }
                    }
                },
                "aws_iam_instance_profile.sandpit-staging-slaves": {
                    "type": "aws_iam_instance_profile",
                    "depends_on": [
                        "aws_iam_role.sandpit-staging-slave-role"
                    ],
                    "primary": {
                        "id": "sandpit-staging-slaves-profile",
                        "attributes": {
                            "arn": "arn:aws:iam::165664414043:instance-profile/sandpit-staging-slaves-profile",
                            "id": "sandpit-staging-slaves-profile",
                            "name": "sandpit-staging-slaves-profile",
                            "path": "/",
                            "roles.#": "1",
                            "roles.2467116355": "sandpit-staging-slave-role"
                        }
                    }
                },
                "aws_iam_role.sandpit-staging-master-role": {
                    "type": "aws_iam_role",
                    "primary": {
                        "id": "sandpit-staging-master-role",
                        "attributes": {
                            "arn": "arn:aws:iam::165664414043:role/sandpit-staging-master-role",
                            "assume_role_policy": "{\n  \"Statement\" : [ {\n    \"Action\" : [ \"sts:AssumeRole\" ],\n    \"Effect\" : \"Allow\",\n    \"Principal\" : {\n      \"Service\" : [ \"ec2.amazonaws.com\" ]\n    }\n  } ],\n  \"Version\" : \"2012-10-17\"\n}",
                            "id": "sandpit-staging-master-role",
                            "name": "sandpit-staging-master-role",
                            "path": "/",
                            "unique_id": "AROAIESQP7BCXLKIGY5JQ"
                        }
                    }
                },
                "aws_iam_role.sandpit-staging-slave-role": {
                    "type": "aws_iam_role",
                    "primary": {
                        "id": "sandpit-staging-slave-role",
                        "attributes": {
                            "arn": "arn:aws:iam::165664414043:role/sandpit-staging-slave-role",
                            "assume_role_policy": "{\n  \"Statement\" : [ {\n    \"Action\" : [ \"sts:AssumeRole\" ],\n    \"Effect\" : \"Allow\",\n    \"Principal\" : {\n      \"Service\" : [ \"ec2.amazonaws.com\" ]\n    }\n  } ],\n  \"Version\" : \"2012-10-17\"\n}",
                            "id": "sandpit-staging-slave-role",
                            "name": "sandpit-staging-slave-role",
                            "path": "/",
                            "unique_id": "AROAJ5HQV2357S6JE5DI4"
                        }
                    }
                },
                "aws_iam_role_policy.sandpit-staging-amazon-s3-policy": {
                    "type": "aws_iam_role_policy",
                    "depends_on": [
                        "aws_iam_role.sandpit-staging-slave-role"
                    ],
                    "primary": {
                        "id": "sandpit-staging-slave-role:sandpit-staging-amazon-s3-policy",
                        "attributes": {
                            "id": "sandpit-staging-slave-role:sandpit-staging-amazon-s3-policy",
                            "name": "sandpit-staging-amazon-s3-policy",
                            "policy": "{\n  \"Version\" : \"2012-10-17\",\n  \"Statement\" : {\n    \"Effect\" : \"Allow\",\n    \"Resource\" : \"*\",\n    \"Action\" : \"s3:*\"\n  }\n}",
                            "role": "sandpit-staging-slave-role"
                        }
                    }
                },
                "aws_iam_role_policy.sandpit-staging-cloudwatch-policy": {
                    "type": "aws_iam_role_policy",
                    "depends_on": [
                        "aws_iam_role.sandpit-staging-slave-role"
                    ],
                    "primary": {
                        "id": "sandpit-staging-slave-role:sandpit-staging-cloudwatch-policy",
                        "attributes": {
                            "id": "sandpit-staging-slave-role:sandpit-staging-cloudwatch-policy",
                            "name": "sandpit-staging-cloudwatch-policy",
                            "policy": "{\n  \"Version\" : \"2012-10-17\",\n  \"Statement\" : {\n    \"Effect\" : \"Allow\",\n    \"Resource\" : \"*\",\n    \"Action\" : [ \"cloudwatch:GetMetricStatistics\", \"cloudwatch:ListMetrics\", \"cloudwatch:PutMetricData\", \"EC2:DescribeTags\" ],\n    \"Condition\" : {\n      \"Bool\" : {\n        \"aws:SecureTransport\" : \"true\"\n      }\n    }\n  }\n}",
                            "role": "sandpit-staging-slave-role"
                        }
                    }
                },
                "aws_iam_role_policy.sandpit-staging-master-auto-scaling-policy": {
                    "type": "aws_iam_role_policy",
                    "depends_on": [
                        "aws_iam_role.sandpit-staging-master-role"
                    ],
                    "primary": {
                        "id": "sandpit-staging-master-role:sandpit-staging-master-auto-scaling-policy",
                        "attributes": {
                            "id": "sandpit-staging-master-role:sandpit-staging-master-auto-scaling-policy",
                            "name": "sandpit-staging-master-auto-scaling-policy",
                            "policy": "{\n  \"Version\" : \"2012-10-17\",\n  \"Statement\" : {\n    \"Effect\" : \"Allow\",\n    \"Resource\" : \"*\",\n    \"Action\" : [ \"ec2:DescribeKeyPairs\", \"ec2:DescribeSubnets\", \"autoscaling:DescribeLaunchConfigurations\", \"autoscaling:UpdateAutoScalingGroup\", \"autoscaling:DescribeAutoScalingGroups\", \"autoscaling:DescribeScalingActivities\", \"elasticloadbalancing:DescribeLoadBalancers\" ]\n  }\n}",
                            "role": "sandpit-staging-master-role"
                        }
                    }
                },
                "aws_iam_role_policy.sandpit-staging-master-s3": {
                    "type": "aws_iam_role_policy",
                    "depends_on": [
                        "aws_iam_role.sandpit-staging-master-role",
                        "aws_s3_bucket.sandpit-staging-exhibitor-s3-bucket"
                    ],
                    "primary": {
                        "id": "sandpit-staging-master-role:sandpit-staging-master-s3",
                        "attributes": {
                            "id": "sandpit-staging-master-role:sandpit-staging-master-s3",
                            "name": "sandpit-staging-master-s3",
                            "policy": "{\n  \"Version\" : \"2012-10-17\",\n  \"Statement\" : {\n    \"Effect\" : \"Allow\",\n    \"Resource\" : [ \"arn:aws:s3:::sandpit-staging-exhibitor-s3-bucket\", \"arn:aws:s3:::sandpit-staging-exhibitor-s3-bucket/*\" ],\n    \"Action\" : [ \"s3:AbortMultipartUpload\", \"s3:DeleteObject\", \"s3:GetBucketAcl\", \"s3:GetBucketPolicy\", \"s3:GetObject\", \"s3:GetObjectAcl\", \"s3:ListBucket\", \"s3:ListBucketMultipartUploads\", \"s3:ListMultipartUploadParts\", \"s3:PutObject\", \"s3:PutObjectAcl\" ]\n  }\n}",
                            "role": "sandpit-staging-master-role"
                        }
                    }
                },
                "aws_iam_role_policy.sandpit-staging-slave-cloudwatch-policy": {
                    "type": "aws_iam_role_policy",
                    "depends_on": [
                        "aws_iam_role.sandpit-staging-slave-role"
                    ],
                    "primary": {
                        "id": "sandpit-staging-slave-role:sandpit-staging-slave-cloudwatch-policy",
                        "attributes": {
                            "id": "sandpit-staging-slave-role:sandpit-staging-slave-cloudwatch-policy",
                            "name": "sandpit-staging-slave-cloudwatch-policy",
                            "policy": "{\n  \"Version\" : \"2012-10-17\",\n  \"Statement\" : {\n    \"Effect\" : \"Allow\",\n    \"Resource\" : \"*\",\n    \"Action\" : [ \"cloudwatch:GetMetricStatistics\", \"cloudwatch:ListMetrics\", \"cloudwatch:PutMetricData\", \"EC2:DescribeTags\" ],\n    \"Condition\" : {\n      \"Bool\" : {\n        \"aws:SecureTransport\" : \"true\"\n      }\n    }\n  }\n}",
                            "role": "sandpit-staging-slave-role"
                        }
                    }
                },
                "aws_iam_role_policy.sandpit-staging-slave-eip-policy": {
                    "type": "aws_iam_role_policy",
                    "depends_on": [
                        "aws_iam_role.sandpit-staging-slave-role"
                    ],
                    "primary": {
                        "id": "sandpit-staging-slave-role:sandpit-staging-slave-eip-policy",
                        "attributes": {
                            "id": "sandpit-staging-slave-role:sandpit-staging-slave-eip-policy",
                            "name": "sandpit-staging-slave-eip-policy",
                            "policy": "{\n  \"Version\" : \"2012-10-17\",\n  \"Statement\" : {\n    \"Effect\" : \"Allow\",\n    \"Resource\" : \"*\",\n    \"Action\" : [ \"ec2:AssociateAddress\" ]\n  }\n}",
                            "role": "sandpit-staging-slave-role"
                        }
                    }
                },
                "aws_iam_user.sandpit-staging-mesos-user": {
                    "type": "aws_iam_user",
                    "primary": {
                        "id": "sandpit-staging-mesos-user",
                        "attributes": {
                            "arn": "arn:aws:iam::165664414043:user/sandpit-staging-mesos-user",
                            "id": "sandpit-staging-mesos-user",
                            "name": "sandpit-staging-mesos-user",
                            "path": "/",
                            "unique_id": "AIDAI3PMIYWLKLYIA3LKA"
                        }
                    }
                },
                "aws_iam_user_policy.sandpit-staging-mesos-user-policy-s3": {
                    "type": "aws_iam_user_policy",
                    "depends_on": [
                        "aws_iam_user.sandpit-staging-mesos-user",
                        "aws_s3_bucket.sandpit-staging-exhibitor-s3-bucket"
                    ],
                    "primary": {
                        "id": "sandpit-staging-mesos-user:sandpit-staging-mesos-user-policy-s3",
                        "attributes": {
                            "id": "sandpit-staging-mesos-user:sandpit-staging-mesos-user-policy-s3",
                            "name": "sandpit-staging-mesos-user-policy-s3",
                            "policy": "{\n  \"Version\" : \"2012-10-17\",\n  \"Statement\" : {\n    \"Effect\" : \"Allow\",\n    \"Resource\" : [ \"arn:aws:s3:::sandpit-staging-exhibitor-s3-bucket\", \"arn:aws:s3:::sandpit-staging-exhibitor-s3-bucket/*\" ],\n    \"Action\" : [ \"s3:AbortMultipartUpload\", \"s3:DeleteObject\", \"s3:GetBucketAcl\", \"s3:GetBucketPolicy\", \"s3:GetObject\", \"s3:GetObjectAcl\", \"s3:ListBucket\", \"s3:ListBucketMultipartUploads\", \"s3:ListMultipartUploadParts\", \"s3:PutObject\", \"s3:PutObjectAcl\" ]\n  }\n}",
                            "user": "sandpit-staging-mesos-user"
                        }
                    }
                },
                "aws_launch_configuration.master-group": {
                    "type": "aws_launch_configuration",
                    "depends_on": [
                        "aws_elb.master-group",
                        "aws_iam_access_key.host-key",
                        "aws_iam_access_key.host-key",
                        "aws_iam_instance_profile.master-group",
                        "aws_iam_role.master-role",
                        "aws_iam_role.slave-role",
                        "aws_security_group.admin-security-group",
                        "aws_security_group.allow_elb_master-group",
                        "aws_security_group.master-security-group"
                    ],
                    "primary": null,
                    "tainted": [
                        {
                            "id": "master-group-duzd5ctj3rdlrcgfil5s4u4bfa",
                            "attributes": {
                                "associate_public_ip_address": "false",
                                "ebs_block_device.#": "0",
                                "ebs_optimized": "false",
                                "enable_monitoring": "true",
                                "ephemeral_block_device.#": "0",
                                "iam_instance_profile": "master-group-profile",
                                "id": "master-group-duzd5ctj3rdlrcgfil5s4u4bfa",
                                "image_id": "ami-07f1ec6b",
                                "instance_type": "m4.xlarge",
                                "key_name": "ops-terraboot",
                                "name": "master-group-duzd5ctj3rdlrcgfil5s4u4bfa",
                                "name_prefix": "master-group-",
                                "root_block_device.#": "0",
                                "security_groups.#": "3",
                                "security_groups.3424462647": "sg-56c4c13f",
                                "security_groups.3867024774": "sg-4e3d3927",
                                "security_groups.4258872513": "sg-29c4c140",
                                "spot_price": "",
                                "user_data": "616ebc6e3f12abc215bb2988f2123c19934e27c9"
                            }
                        },
                        {
                            "id": "master-group-duzd5ctj3rdlrcgfil5s4u4bfa",
                            "attributes": {
                                "associate_public_ip_address": "false",
                                "ebs_block_device.#": "0",
                                "ebs_optimized": "false",
                                "enable_monitoring": "true",
                                "ephemeral_block_device.#": "0",
                                "iam_instance_profile": "master-group-profile",
                                "id": "master-group-duzd5ctj3rdlrcgfil5s4u4bfa",
                                "image_id": "ami-07f1ec6b",
                                "instance_type": "m4.xlarge",
                                "key_name": "ops-terraboot",
                                "name": "master-group-duzd5ctj3rdlrcgfil5s4u4bfa",
                                "name_prefix": "master-group-",
                                "root_block_device.#": "0",
                                "security_groups.#": "3",
                                "security_groups.3424462647": "sg-56c4c13f",
                                "security_groups.3867024774": "sg-4e3d3927",
                                "security_groups.4258872513": "sg-29c4c140",
                                "spot_price": "",
                                "user_data": "616ebc6e3f12abc215bb2988f2123c19934e27c9"
                            }
                        }
                    ]
                },
                "aws_launch_configuration.public-slave-group": {
                    "type": "aws_launch_configuration",
                    "depends_on": [
                        "aws_elb.master-group",
                        "aws_iam_access_key.host-key",
                        "aws_iam_access_key.host-key",
                        "aws_iam_instance_profile.public-slave-group",
                        "aws_iam_role.master-role",
                        "aws_iam_role.slave-role",
                        "aws_security_group.allow_elb_public-slave-group",
                        "aws_security_group.public-slave-security-group"
                    ],
                    "primary": null,
                    "tainted": [
                        {
                            "id": "public-slave-group-z3tmx5kwuvdxha3w36fhgcugxe",
                            "attributes": {
                                "associate_public_ip_address": "false",
                                "ebs_block_device.#": "0",
                                "ebs_optimized": "false",
                                "enable_monitoring": "true",
                                "ephemeral_block_device.#": "0",
                                "iam_instance_profile": "public-slave-group-profile",
                                "id": "public-slave-group-z3tmx5kwuvdxha3w36fhgcugxe",
                                "image_id": "ami-07f1ec6b",
                                "instance_type": "m4.xlarge",
                                "key_name": "ops-terraboot",
                                "name": "public-slave-group-z3tmx5kwuvdxha3w36fhgcugxe",
                                "name_prefix": "public-slave-group-",
                                "root_block_device.#": "0",
                                "security_groups.#": "2",
                                "security_groups.1881929361": "sg-403d3929",
                                "security_groups.839245984": "sg-2bc4c142",
                                "spot_price": "",
                                "user_data": "cbabe1379ac5d15fc18d0488c0c766c5fa32f463"
                            }
                        },
                        {
                            "id": "public-slave-group-z3tmx5kwuvdxha3w36fhgcugxe",
                            "attributes": {
                                "associate_public_ip_address": "false",
                                "ebs_block_device.#": "0",
                                "ebs_optimized": "false",
                                "enable_monitoring": "true",
                                "ephemeral_block_device.#": "0",
                                "iam_instance_profile": "public-slave-group-profile",
                                "id": "public-slave-group-z3tmx5kwuvdxha3w36fhgcugxe",
                                "image_id": "ami-07f1ec6b",
                                "instance_type": "m4.xlarge",
                                "key_name": "ops-terraboot",
                                "name": "public-slave-group-z3tmx5kwuvdxha3w36fhgcugxe",
                                "name_prefix": "public-slave-group-",
                                "root_block_device.#": "0",
                                "security_groups.#": "2",
                                "security_groups.1881929361": "sg-403d3929",
                                "security_groups.839245984": "sg-2bc4c142",
                                "spot_price": "",
                                "user_data": "cbabe1379ac5d15fc18d0488c0c766c5fa32f463"
                            }
                        }
                    ]
                },
                "aws_launch_configuration.sandpit-staging-masters": {
                    "type": "aws_launch_configuration",
                    "depends_on": [
                        "aws_iam_instance_profile.sandpit-staging-masters",
                        "aws_security_group.sandpit-staging-admin-security-group",
                        "aws_security_group.sandpit-staging-master-security-group",
                        "template_file.sandpit-staging-master-user-data",
                        "terraform_remote_state.vpc",
                        "terraform_remote_state.vpc",
                        "terraform_remote_state.vpc",
                        "terraform_remote_state.vpc"
                    ],
                    "primary": {
                        "id": "sandpit-staging-masters-wzsm2cpd4zb7pcs2co4ra2cahe",
                        "attributes": {
                            "associate_public_ip_address": "true",
                            "ebs_block_device.#": "0",
                            "ebs_optimized": "false",
                            "enable_monitoring": "true",
                            "ephemeral_block_device.#": "0",
                            "iam_instance_profile": "sandpit-staging-masters-profile",
                            "id": "sandpit-staging-masters-wzsm2cpd4zb7pcs2co4ra2cahe",
                            "image_id": "ami-1807e377",
                            "instance_type": "m4.large",
                            "key_name": "ops-terraboot",
                            "name": "sandpit-staging-masters-wzsm2cpd4zb7pcs2co4ra2cahe",
                            "name_prefix": "sandpit-staging-masters-",
                            "root_block_device.#": "1",
                            "root_block_device.0.delete_on_termination": "true",
                            "root_block_device.0.iops": "0",
                            "root_block_device.0.volume_size": "20",
                            "root_block_device.0.volume_type": "",
                            "security_groups.#": "6",
                            "security_groups.1489236821": "sg-2579634c",
                            "security_groups.1948651400": "sg-a327c4cb",
                            "security_groups.202169469": "sg-213b2748",
                            "security_groups.2578033345": "sg-a06e63c9",
                            "security_groups.423697735": "sg-2679634f",
                            "security_groups.813833176": "sg-ad6e63c4",
                            "spot_price": "",
                            "user_data": "0d6dc00e3185f8890ff93929589f911383b0eb8b"
                        }
                    }
                },
                "aws_launch_configuration.sandpit-staging-public-slaves": {
                    "type": "aws_launch_configuration",
                    "depends_on": [
                        "aws_iam_instance_profile.sandpit-staging-public-slaves",
                        "aws_security_group.sandpit-staging-public-slave-security-group",
                        "template_file.sandpit-staging-public-slave-user-data",
                        "terraform_remote_state.vpc",
                        "terraform_remote_state.vpc",
                        "terraform_remote_state.vpc"
                    ],
                    "primary": {
                        "id": "sandpit-staging-public-slaves-uzcdcxzuxnhyta3lbggxniisgm",
                        "attributes": {
                            "associate_public_ip_address": "true",
                            "ebs_block_device.#": "0",
                            "ebs_optimized": "false",
                            "enable_monitoring": "true",
                            "ephemeral_block_device.#": "0",
                            "iam_instance_profile": "sandpit-staging-public-slaves-profile",
                            "id": "sandpit-staging-public-slaves-uzcdcxzuxnhyta3lbggxniisgm",
                            "image_id": "ami-1807e377",
                            "instance_type": "m4.xlarge",
                            "key_name": "ops-terraboot",
                            "name": "sandpit-staging-public-slaves-uzcdcxzuxnhyta3lbggxniisgm",
                            "name_prefix": "sandpit-staging-public-slaves-",
                            "root_block_device.#": "0",
                            "security_groups.#": "4",
                            "security_groups.1948651400": "sg-a327c4cb",
                            "security_groups.202169469": "sg-213b2748",
                            "security_groups.641681225": "sg-2779634e",
                            "security_groups.813833176": "sg-ad6e63c4",
                            "spot_price": "",
                            "user_data": "d1ec48aade40a5197f615da51659d7905da40232"
                        }
                    }
                },
                "aws_launch_configuration.sandpit-staging-slaves": {
                    "type": "aws_launch_configuration",
                    "depends_on": [
                        "aws_iam_instance_profile.sandpit-staging-slaves",
                        "aws_security_group.sandpit-staging-slave-security-group",
                        "template_file.sandpit-staging-slave-user-data",
                        "terraform_remote_state.vpc",
                        "terraform_remote_state.vpc",
                        "terraform_remote_state.vpc",
                        "terraform_remote_state.vpc"
                    ],
                    "primary": {
                        "id": "sandpit-staging-slaves-5kopy475h5anddfrfc53ajvbwy",
                        "attributes": {
                            "associate_public_ip_address": "false",
                            "ebs_block_device.#": "0",
                            "ebs_optimized": "false",
                            "enable_monitoring": "true",
                            "ephemeral_block_device.#": "0",
                            "iam_instance_profile": "sandpit-staging-slaves-profile",
                            "id": "sandpit-staging-slaves-5kopy475h5anddfrfc53ajvbwy",
                            "image_id": "ami-1807e377",
                            "instance_type": "m4.xlarge",
                            "key_name": "ops-terraboot",
                            "name": "sandpit-staging-slaves-5kopy475h5anddfrfc53ajvbwy",
                            "name_prefix": "sandpit-staging-slaves-",
                            "root_block_device.#": "0",
                            "security_groups.#": "5",
                            "security_groups.1624272194": "sg-2479634d",
                            "security_groups.1948651400": "sg-a327c4cb",
                            "security_groups.202169469": "sg-213b2748",
                            "security_groups.2578033345": "sg-a06e63c9",
                            "security_groups.813833176": "sg-ad6e63c4",
                            "spot_price": "",
                            "user_data": "f5d22eabcad14f8441f2c71a31ea7ca90f17c590"
                        }
                    }
                },
                "aws_launch_configuration.slave-group": {
                    "type": "aws_launch_configuration",
                    "depends_on": [
                        "aws_elb.master-group",
                        "aws_iam_access_key.host-key",
                        "aws_iam_access_key.host-key",
                        "aws_iam_instance_profile.slave-group",
                        "aws_iam_role.master-role",
                        "aws_iam_role.slave-role",
                        "aws_security_group.slave-security-group"
                    ],
                    "primary": null,
                    "tainted": [
                        {
                            "id": "slave-group-7eblfxpqfrb67dabuw5jiet34m",
                            "attributes": {
                                "associate_public_ip_address": "false",
                                "ebs_block_device.#": "0",
                                "ebs_optimized": "false",
                                "enable_monitoring": "true",
                                "ephemeral_block_device.#": "0",
                                "iam_instance_profile": "slave-group-profile",
                                "id": "slave-group-7eblfxpqfrb67dabuw5jiet34m",
                                "image_id": "ami-07f1ec6b",
                                "instance_type": "m4.xlarge",
                                "key_name": "ops-terraboot",
                                "name": "slave-group-7eblfxpqfrb67dabuw5jiet34m",
                                "name_prefix": "slave-group-",
                                "root_block_device.#": "0",
                                "security_groups.#": "1",
                                "security_groups.749275107": "sg-28c4c141",
                                "spot_price": "",
                                "user_data": "046b933e74f7baa5aedecc34882f0fff2d431e69"
                            }
                        },
                        {
                            "id": "slave-group-7eblfxpqfrb67dabuw5jiet34m",
                            "attributes": {
                                "associate_public_ip_address": "false",
                                "ebs_block_device.#": "0",
                                "ebs_optimized": "false",
                                "enable_monitoring": "true",
                                "ephemeral_block_device.#": "0",
                                "iam_instance_profile": "slave-group-profile",
                                "id": "slave-group-7eblfxpqfrb67dabuw5jiet34m",
                                "image_id": "ami-07f1ec6b",
                                "instance_type": "m4.xlarge",
                                "key_name": "ops-terraboot",
                                "name": "slave-group-7eblfxpqfrb67dabuw5jiet34m",
                                "name_prefix": "slave-group-",
                                "root_block_device.#": "0",
                                "security_groups.#": "1",
                                "security_groups.749275107": "sg-28c4c141",
                                "spot_price": "",
                                "user_data": "046b933e74f7baa5aedecc34882f0fff2d431e69"
                            }
                        }
                    ]
                },
                "aws_route53_record.sandpit-staging-deploy__mastodonc__net": {
                    "type": "aws_route53_record",
                    "depends_on": [
                        "aws_elb.sandpit-staging-public-slaves",
                        "aws_elb.sandpit-staging-public-slaves"
                    ],
                    "primary": {
                        "id": "Z1EFD0WXZUIXYT_sandpit-staging-deploy.mastodonc.net_A",
                        "attributes": {
                            "alias.#": "1",
                            "alias.1139529938.evaluate_target_health": "true",
                            "alias.1139529938.name": "sandpit-staging-public-slaves-1802906586.eu-central-1.elb.amazonaws.com",
                            "alias.1139529938.zone_id": "Z215JYRZR1TBD5",
                            "failover": "",
                            "fqdn": "sandpit-staging-deploy.mastodonc.net",
                            "health_check_id": "",
                            "id": "Z1EFD0WXZUIXYT_sandpit-staging-deploy.mastodonc.net_A",
                            "name": "sandpit-staging-deploy.mastodonc.net",
                            "records.#": "0",
                            "set_identifier": "",
                            "ttl": "0",
                            "type": "A",
                            "weight": "-1",
                            "zone_id": "Z1EFD0WXZUIXYT"
                        }
                    }
                },
                "aws_route53_record.sandpit-staging__mastodonc__net": {
                    "type": "aws_route53_record",
                    "depends_on": [
                        "aws_elb.sandpit-staging-public-slaves",
                        "aws_elb.sandpit-staging-public-slaves"
                    ],
                    "primary": {
                        "id": "Z1EFD0WXZUIXYT_sandpit-staging.mastodonc.net_A",
                        "attributes": {
                            "alias.#": "1",
                            "alias.1139529938.evaluate_target_health": "true",
                            "alias.1139529938.name": "sandpit-staging-public-slaves-1802906586.eu-central-1.elb.amazonaws.com",
                            "alias.1139529938.zone_id": "Z215JYRZR1TBD5",
                            "failover": "",
                            "fqdn": "sandpit-staging.mastodonc.net",
                            "health_check_id": "",
                            "id": "Z1EFD0WXZUIXYT_sandpit-staging.mastodonc.net_A",
                            "name": "sandpit-staging.mastodonc.net",
                            "records.#": "0",
                            "set_identifier": "",
                            "ttl": "0",
                            "type": "A",
                            "weight": "-1",
                            "zone_id": "Z1EFD0WXZUIXYT"
                        }
                    }
                },
                "aws_s3_bucket.sandpit-staging-exhibitor-s3-bucket": {
                    "type": "aws_s3_bucket",
                    "primary": {
                        "id": "sandpit-staging-exhibitor-s3-bucket",
                        "attributes": {
                            "acl": "private",
                            "arn": "arn:aws:s3:::sandpit-staging-exhibitor-s3-bucket",
                            "bucket": "sandpit-staging-exhibitor-s3-bucket",
                            "cors_rule.#": "0",
                            "force_destroy": "false",
                            "hosted_zone_id": "Z21DNDUVLTQW6Q",
                            "id": "sandpit-staging-exhibitor-s3-bucket",
                            "policy": "",
                            "region": "eu-central-1",
                            "tags.#": "0",
                            "website.#": "0"
                        }
                    }
                },
                "aws_security_group.sandpit-staging-admin-security-group": {
                    "type": "aws_security_group",
                    "depends_on": [
                        "terraform_remote_state.vpc"
                    ],
                    "primary": {
                        "id": "sg-2679634f",
                        "attributes": {
                            "description": "Managed by Terraform",
                            "egress.#": "0",
                            "id": "sg-2679634f",
                            "ingress.#": "2",
                            "ingress.1857834854.cidr_blocks.#": "1",
                            "ingress.1857834854.cidr_blocks.0": "172.20.0.0/20",
                            "ingress.1857834854.from_port": "0",
                            "ingress.1857834854.protocol": "tcp",
                            "ingress.1857834854.security_groups.#": "0",
                            "ingress.1857834854.self": "false",
                            "ingress.1857834854.to_port": "65535",
                            "ingress.2569057007.cidr_blocks.#": "1",
                            "ingress.2569057007.cidr_blocks.0": "172.20.0.0/20",
                            "ingress.2569057007.from_port": "0",
                            "ingress.2569057007.protocol": "udp",
                            "ingress.2569057007.security_groups.#": "0",
                            "ingress.2569057007.self": "false",
                            "ingress.2569057007.to_port": "65535",
                            "name": "sandpit-staging-admin-security-group",
                            "owner_id": "165664414043",
                            "tags.#": "1",
                            "tags.Name": "sandpit-staging-admin-security-group",
                            "vpc_id": "vpc-3739425e"
                        }
                    }
                },
                "aws_security_group.sandpit-staging-dns": {
                    "type": "aws_security_group",
                    "depends_on": [
                        "terraform_remote_state.vpc"
                    ],
                    "primary": {
                        "id": "sg-7650b61e",
                        "attributes": {
                            "description": "Managed by Terraform",
                            "egress.#": "0",
                            "id": "sg-7650b61e",
                            "ingress.#": "2",
                            "ingress.1428540150.cidr_blocks.#": "1",
                            "ingress.1428540150.cidr_blocks.0": "172.20.0.0/20",
                            "ingress.1428540150.from_port": "53",
                            "ingress.1428540150.protocol": "tcp",
                            "ingress.1428540150.security_groups.#": "0",
                            "ingress.1428540150.self": "false",
                            "ingress.1428540150.to_port": "53",
                            "ingress.2730047359.cidr_blocks.#": "1",
                            "ingress.2730047359.cidr_blocks.0": "172.20.0.0/20",
                            "ingress.2730047359.from_port": "53",
                            "ingress.2730047359.protocol": "udp",
                            "ingress.2730047359.security_groups.#": "0",
                            "ingress.2730047359.self": "false",
                            "ingress.2730047359.to_port": "53",
                            "name": "sandpit-staging-dns",
                            "owner_id": "165664414043",
                            "tags.#": "1",
                            "tags.Name": "sandpit-staging-dns",
                            "vpc_id": "vpc-3739425e"
                        }
                    }
                },
                "aws_security_group.sandpit-staging-lb-security-group": {
                    "type": "aws_security_group",
                    "depends_on": [
                        "terraform_remote_state.vpc"
                    ],
                    "primary": {
                        "id": "sg-2279634b",
                        "attributes": {
                            "description": "Managed by Terraform",
                            "egress.#": "1",
                            "egress.482069346.cidr_blocks.#": "1",
                            "egress.482069346.cidr_blocks.0": "0.0.0.0/0",
                            "egress.482069346.from_port": "0",
                            "egress.482069346.protocol": "-1",
                            "egress.482069346.security_groups.#": "0",
                            "egress.482069346.self": "false",
                            "egress.482069346.to_port": "0",
                            "id": "sg-2279634b",
                            "ingress.#": "1",
                            "ingress.2316642503.cidr_blocks.#": "0",
                            "ingress.2316642503.from_port": "2181",
                            "ingress.2316642503.protocol": "tcp",
                            "ingress.2316642503.security_groups.#": "1",
                            "ingress.2316642503.security_groups.1624272194": "sg-2479634d",
                            "ingress.2316642503.self": "false",
                            "ingress.2316642503.to_port": "2181",
                            "name": "sandpit-staging-lb-security-group",
                            "owner_id": "165664414043",
                            "tags.#": "1",
                            "tags.Name": "sandpit-staging-lb-security-group",
                            "vpc_id": "vpc-3739425e"
                        }
                    }
                },
                "aws_security_group.sandpit-staging-master-security-group": {
                    "type": "aws_security_group",
                    "depends_on": [
                        "terraform_remote_state.vpc"
                    ],
                    "primary": {
                        "id": "sg-2579634c",
                        "attributes": {
                            "description": "Managed by Terraform",
                            "egress.#": "0",
                            "id": "sg-2579634c",
                            "ingress.#": "9",
                            "ingress.1423708822.cidr_blocks.#": "0",
                            "ingress.1423708822.from_port": "53",
                            "ingress.1423708822.protocol": "udp",
                            "ingress.1423708822.security_groups.#": "1",
                            "ingress.1423708822.security_groups.3080925112": "sg-7650b61e",
                            "ingress.1423708822.self": "false",
                            "ingress.1423708822.to_port": "53",
                            "ingress.1961040487.cidr_blocks.#": "0",
                            "ingress.1961040487.from_port": "80",
                            "ingress.1961040487.protocol": "tcp",
                            "ingress.1961040487.security_groups.#": "1",
                            "ingress.1961040487.security_groups.3932421453": "sg-2279634b",
                            "ingress.1961040487.self": "false",
                            "ingress.1961040487.to_port": "80",
                            "ingress.3027966217.cidr_blocks.#": "0",
                            "ingress.3027966217.from_port": "0",
                            "ingress.3027966217.protocol": "-1",
                            "ingress.3027966217.security_groups.#": "2",
                            "ingress.3027966217.security_groups.1624272194": "sg-2479634d",
                            "ingress.3027966217.security_groups.641681225": "sg-2779634e",
                            "ingress.3027966217.self": "false",
                            "ingress.3027966217.to_port": "0",
                            "ingress.3585322442.cidr_blocks.#": "0",
                            "ingress.3585322442.from_port": "8080",
                            "ingress.3585322442.protocol": "tcp",
                            "ingress.3585322442.security_groups.#": "1",
                            "ingress.3585322442.security_groups.3932421453": "sg-2279634b",
                            "ingress.3585322442.self": "false",
                            "ingress.3585322442.to_port": "8080",
                            "ingress.3731578767.cidr_blocks.#": "0",
                            "ingress.3731578767.from_port": "8181",
                            "ingress.3731578767.protocol": "tcp",
                            "ingress.3731578767.security_groups.#": "1",
                            "ingress.3731578767.security_groups.3932421453": "sg-2279634b",
                            "ingress.3731578767.self": "false",
                            "ingress.3731578767.to_port": "8181",
                            "ingress.4228913403.cidr_blocks.#": "0",
                            "ingress.4228913403.from_port": "5050",
                            "ingress.4228913403.protocol": "tcp",
                            "ingress.4228913403.security_groups.#": "1",
                            "ingress.4228913403.security_groups.3932421453": "sg-2279634b",
                            "ingress.4228913403.self": "false",
                            "ingress.4228913403.to_port": "5050",
                            "ingress.4251191458.cidr_blocks.#": "0",
                            "ingress.4251191458.from_port": "0",
                            "ingress.4251191458.protocol": "icmp",
                            "ingress.4251191458.security_groups.#": "1",
                            "ingress.4251191458.security_groups.720564339": "sg-4200e32a",
                            "ingress.4251191458.self": "false",
                            "ingress.4251191458.to_port": "-1",
                            "ingress.438339270.cidr_blocks.#": "0",
                            "ingress.438339270.from_port": "2181",
                            "ingress.438339270.protocol": "tcp",
                            "ingress.438339270.security_groups.#": "1",
                            "ingress.438339270.security_groups.3932421453": "sg-2279634b",
                            "ingress.438339270.self": "false",
                            "ingress.438339270.to_port": "2181",
                            "ingress.705949710.cidr_blocks.#": "0",
                            "ingress.705949710.from_port": "53",
                            "ingress.705949710.protocol": "tcp",
                            "ingress.705949710.security_groups.#": "1",
                            "ingress.705949710.security_groups.3080925112": "sg-7650b61e",
                            "ingress.705949710.self": "false",
                            "ingress.705949710.to_port": "53",
                            "name": "sandpit-staging-master-security-group",
                            "owner_id": "165664414043",
                            "tags.#": "1",
                            "tags.Name": "sandpit-staging-master-security-group",
                            "vpc_id": "vpc-3739425e"
                        }
                    }
                },
                "aws_security_group.sandpit-staging-public-slave-security-group": {
                    "type": "aws_security_group",
                    "depends_on": [
                        "terraform_remote_state.vpc"
                    ],
                    "primary": {
                        "id": "sg-2779634e",
                        "attributes": {
                            "description": "Managed by Terraform",
                            "egress.#": "1",
                            "egress.482069346.cidr_blocks.#": "1",
                            "egress.482069346.cidr_blocks.0": "0.0.0.0/0",
                            "egress.482069346.from_port": "0",
                            "egress.482069346.protocol": "-1",
                            "egress.482069346.security_groups.#": "0",
                            "egress.482069346.self": "false",
                            "egress.482069346.to_port": "0",
                            "id": "sg-2779634e",
                            "ingress.#": "9",
                            "ingress.1217125192.cidr_blocks.#": "1",
                            "ingress.1217125192.cidr_blocks.0": "0.0.0.0/0",
                            "ingress.1217125192.from_port": "0",
                            "ingress.1217125192.protocol": "tcp",
                            "ingress.1217125192.security_groups.#": "0",
                            "ingress.1217125192.self": "false",
                            "ingress.1217125192.to_port": "21",
                            "ingress.1674008004.cidr_blocks.#": "1",
                            "ingress.1674008004.cidr_blocks.0": "172.20.0.0/20",
                            "ingress.1674008004.from_port": "0",
                            "ingress.1674008004.protocol": "icmp",
                            "ingress.1674008004.security_groups.#": "0",
                            "ingress.1674008004.self": "false",
                            "ingress.1674008004.to_port": "-1",
                            "ingress.1741843269.cidr_blocks.#": "1",
                            "ingress.1741843269.cidr_blocks.0": "0.0.0.0/0",
                            "ingress.1741843269.from_port": "0",
                            "ingress.1741843269.protocol": "udp",
                            "ingress.1741843269.security_groups.#": "0",
                            "ingress.1741843269.self": "false",
                            "ingress.1741843269.to_port": "21",
                            "ingress.2394445110.cidr_blocks.#": "0",
                            "ingress.2394445110.from_port": "0",
                            "ingress.2394445110.protocol": "-1",
                            "ingress.2394445110.security_groups.#": "2",
                            "ingress.2394445110.security_groups.1489236821": "sg-2579634c",
                            "ingress.2394445110.security_groups.1624272194": "sg-2479634d",
                            "ingress.2394445110.self": "true",
                            "ingress.2394445110.to_port": "0",
                            "ingress.2420401050.cidr_blocks.#": "1",
                            "ingress.2420401050.cidr_blocks.0": "0.0.0.0/0",
                            "ingress.2420401050.from_port": "5052",
                            "ingress.2420401050.protocol": "tcp",
                            "ingress.2420401050.security_groups.#": "0",
                            "ingress.2420401050.self": "false",
                            "ingress.2420401050.to_port": "65535",
                            "ingress.3066583803.cidr_blocks.#": "1",
                            "ingress.3066583803.cidr_blocks.0": "172.20.0.0/20",
                            "ingress.3066583803.from_port": "22",
                            "ingress.3066583803.protocol": "tcp",
                            "ingress.3066583803.security_groups.#": "0",
                            "ingress.3066583803.self": "false",
                            "ingress.3066583803.to_port": "22",
                            "ingress.3206402967.cidr_blocks.#": "1",
                            "ingress.3206402967.cidr_blocks.0": "0.0.0.0/0",
                            "ingress.3206402967.from_port": "5052",
                            "ingress.3206402967.protocol": "udp",
                            "ingress.3206402967.security_groups.#": "0",
                            "ingress.3206402967.self": "false",
                            "ingress.3206402967.to_port": "65535",
                            "ingress.477657457.cidr_blocks.#": "1",
                            "ingress.477657457.cidr_blocks.0": "0.0.0.0/0",
                            "ingress.477657457.from_port": "23",
                            "ingress.477657457.protocol": "udp",
                            "ingress.477657457.security_groups.#": "0",
                            "ingress.477657457.self": "false",
                            "ingress.477657457.to_port": "5050",
                            "ingress.857852284.cidr_blocks.#": "1",
                            "ingress.857852284.cidr_blocks.0": "0.0.0.0/0",
                            "ingress.857852284.from_port": "23",
                            "ingress.857852284.protocol": "tcp",
                            "ingress.857852284.security_groups.#": "0",
                            "ingress.857852284.self": "false",
                            "ingress.857852284.to_port": "5050",
                            "name": "sandpit-staging-public-slave-security-group",
                            "owner_id": "165664414043",
                            "tags.#": "1",
                            "tags.Name": "sandpit-staging-public-slave-security-group",
                            "vpc_id": "vpc-3739425e"
                        }
                    }
                },
                "aws_security_group.sandpit-staging-slave-security-group": {
                    "type": "aws_security_group",
                    "depends_on": [
                        "terraform_remote_state.vpc"
                    ],
                    "primary": {
                        "id": "sg-2479634d",
                        "attributes": {
                            "description": "Managed by Terraform",
                            "egress.#": "0",
                            "id": "sg-2479634d",
                            "ingress.#": "2",
                            "ingress.2590860363.cidr_blocks.#": "0",
                            "ingress.2590860363.from_port": "0",
                            "ingress.2590860363.protocol": "-1",
                            "ingress.2590860363.security_groups.#": "2",
                            "ingress.2590860363.security_groups.1489236821": "sg-2579634c",
                            "ingress.2590860363.security_groups.641681225": "sg-2779634e",
                            "ingress.2590860363.self": "true",
                            "ingress.2590860363.to_port": "0",
                            "ingress.438339270.cidr_blocks.#": "0",
                            "ingress.438339270.from_port": "2181",
                            "ingress.438339270.protocol": "tcp",
                            "ingress.438339270.security_groups.#": "1",
                            "ingress.438339270.security_groups.3932421453": "sg-2279634b",
                            "ingress.438339270.self": "false",
                            "ingress.438339270.to_port": "2181",
                            "name": "sandpit-staging-slave-security-group",
                            "owner_id": "165664414043",
                            "tags.#": "1",
                            "tags.Name": "sandpit-staging-slave-security-group",
                            "vpc_id": "vpc-3739425e"
                        }
                    }
                },
                "aws_security_group_rule.sandpit-staging-admin-security-group-1249640833": {
                    "type": "aws_security_group_rule",
                    "depends_on": [
                        "aws_security_group.sandpit-staging-admin-security-group"
                    ],
                    "primary": {
                        "id": "sgrule-4244085180",
                        "attributes": {
                            "cidr_blocks.#": "1",
                            "cidr_blocks.0": "172.20.0.0/20",
                            "from_port": "0",
                            "id": "sgrule-4244085180",
                            "protocol": "udp",
                            "security_group_id": "sg-2679634f",
                            "self": "false",
                            "to_port": "65535",
                            "type": "ingress"
                        },
                        "meta": {
                            "schema_version": "2"
                        }
                    }
                },
                "aws_security_group_rule.sandpit-staging-admin-security-group-2117656632": {
                    "type": "aws_security_group_rule",
                    "depends_on": [
                        "aws_security_group.sandpit-staging-admin-security-group"
                    ],
                    "primary": {
                        "id": "sgrule-3585786755",
                        "attributes": {
                            "cidr_blocks.#": "1",
                            "cidr_blocks.0": "172.20.0.0/20",
                            "from_port": "0",
                            "id": "sgrule-3585786755",
                            "protocol": "tcp",
                            "security_group_id": "sg-2679634f",
                            "self": "false",
                            "to_port": "65535",
                            "type": "ingress"
                        },
                        "meta": {
                            "schema_version": "2"
                        }
                    }
                },
                "aws_security_group_rule.sandpit-staging-dns--1434202576": {
                    "type": "aws_security_group_rule",
                    "depends_on": [
                        "aws_security_group.sandpit-staging-dns"
                    ],
                    "primary": {
                        "id": "sgrule-1323471925",
                        "attributes": {
                            "cidr_blocks.#": "1",
                            "cidr_blocks.0": "172.20.0.0/20",
                            "from_port": "53",
                            "id": "sgrule-1323471925",
                            "protocol": "udp",
                            "security_group_id": "sg-7650b61e",
                            "self": "false",
                            "to_port": "53",
                            "type": "ingress"
                        },
                        "meta": {
                            "schema_version": "2"
                        }
                    }
                },
                "aws_security_group_rule.sandpit-staging-dns--848559867": {
                    "type": "aws_security_group_rule",
                    "depends_on": [
                        "aws_security_group.sandpit-staging-dns"
                    ],
                    "primary": {
                        "id": "sgrule-1739574794",
                        "attributes": {
                            "cidr_blocks.#": "1",
                            "cidr_blocks.0": "172.20.0.0/20",
                            "from_port": "53",
                            "id": "sgrule-1739574794",
                            "protocol": "tcp",
                            "security_group_id": "sg-7650b61e",
                            "self": "false",
                            "to_port": "53",
                            "type": "ingress"
                        },
                        "meta": {
                            "schema_version": "2"
                        }
                    }
                },
                "aws_security_group_rule.sandpit-staging-lb-security-group--1468802869": {
                    "type": "aws_security_group_rule",
                    "depends_on": [
                        "aws_security_group.sandpit-staging-lb-security-group",
                        "aws_security_group.sandpit-staging-slave-security-group"
                    ],
                    "primary": {
                        "id": "sgrule-4195561776",
                        "attributes": {
                            "cidr_blocks.#": "0",
                            "from_port": "2181",
                            "id": "sgrule-4195561776",
                            "protocol": "tcp",
                            "security_group_id": "sg-2279634b",
                            "self": "false",
                            "source_security_group_id": "sg-2479634d",
                            "to_port": "2181",
                            "type": "ingress"
                        },
                        "meta": {
                            "schema_version": "2"
                        }
                    }
                },
                "aws_security_group_rule.sandpit-staging-lb-security-group-2100262736": {
                    "type": "aws_security_group_rule",
                    "depends_on": [
                        "aws_security_group.sandpit-staging-lb-security-group"
                    ],
                    "primary": {
                        "id": "sgrule-2764481019",
                        "attributes": {
                            "cidr_blocks.#": "1",
                            "cidr_blocks.0": "0.0.0.0/0",
                            "from_port": "0",
                            "id": "sgrule-2764481019",
                            "protocol": "-1",
                            "security_group_id": "sg-2279634b",
                            "self": "false",
                            "to_port": "0",
                            "type": "egress"
                        },
                        "meta": {
                            "schema_version": "2"
                        }
                    }
                },
                "aws_security_group_rule.sandpit-staging-master-security-group--155772097": {
                    "type": "aws_security_group_rule",
                    "depends_on": [
                        "aws_security_group.sandpit-staging-lb-security-group",
                        "aws_security_group.sandpit-staging-master-security-group"
                    ],
                    "primary": {
                        "id": "sgrule-3452024178",
                        "attributes": {
                            "cidr_blocks.#": "0",
                            "from_port": "8181",
                            "id": "sgrule-3452024178",
                            "protocol": "tcp",
                            "security_group_id": "sg-2579634c",
                            "self": "false",
                            "source_security_group_id": "sg-2279634b",
                            "to_port": "8181",
                            "type": "ingress"
                        },
                        "meta": {
                            "schema_version": "2"
                        }
                    }
                },
                "aws_security_group_rule.sandpit-staging-master-security-group--674717833": {
                    "type": "aws_security_group_rule",
                    "depends_on": [
                        "aws_security_group.sandpit-staging-master-security-group",
                        "aws_security_group.sandpit-staging-public-slave-security-group"
                    ],
                    "primary": {
                        "id": "sgrule-1559029768",
                        "attributes": {
                            "cidr_blocks.#": "0",
                            "from_port": "0",
                            "id": "sgrule-1559029768",
                            "protocol": "-1",
                            "security_group_id": "sg-2579634c",
                            "self": "false",
                            "source_security_group_id": "sg-2779634e",
                            "to_port": "0",
                            "type": "ingress"
                        },
                        "meta": {
                            "schema_version": "2"
                        }
                    }
                },
                "aws_security_group_rule.sandpit-staging-master-security-group--936757150": {
                    "type": "aws_security_group_rule",
                    "depends_on": [
                        "aws_security_group.sandpit-staging-lb-security-group",
                        "aws_security_group.sandpit-staging-master-security-group"
                    ],
                    "primary": {
                        "id": "sgrule-58647991",
                        "attributes": {
                            "cidr_blocks.#": "0",
                            "from_port": "2181",
                            "id": "sgrule-58647991",
                            "protocol": "tcp",
                            "security_group_id": "sg-2579634c",
                            "self": "false",
                            "source_security_group_id": "sg-2279634b",
                            "to_port": "2181",
                            "type": "ingress"
                        },
                        "meta": {
                            "schema_version": "2"
                        }
                    }
                },
                "aws_security_group_rule.sandpit-staging-master-security-group-1199746866": {
                    "type": "aws_security_group_rule",
                    "depends_on": [
                        "aws_security_group.sandpit-staging-lb-security-group",
                        "aws_security_group.sandpit-staging-master-security-group"
                    ],
                    "primary": {
                        "id": "sgrule-3872785578",
                        "attributes": {
                            "cidr_blocks.#": "0",
                            "from_port": "5050",
                            "id": "sgrule-3872785578",
                            "protocol": "tcp",
                            "security_group_id": "sg-2579634c",
                            "self": "false",
                            "source_security_group_id": "sg-2279634b",
                            "to_port": "5050",
                            "type": "ingress"
                        },
                        "meta": {
                            "schema_version": "2"
                        }
                    }
                },
                "aws_security_group_rule.sandpit-staging-master-security-group-1743741962": {
                    "type": "aws_security_group_rule",
                    "depends_on": [
                        "aws_security_group.sandpit-staging-master-security-group",
                        "aws_security_group.sandpit-staging-slave-security-group"
                    ],
                    "primary": {
                        "id": "sgrule-1688452858",
                        "attributes": {
                            "cidr_blocks.#": "0",
                            "from_port": "0",
                            "id": "sgrule-1688452858",
                            "protocol": "-1",
                            "security_group_id": "sg-2579634c",
                            "self": "false",
                            "source_security_group_id": "sg-2479634d",
                            "to_port": "0",
                            "type": "ingress"
                        },
                        "meta": {
                            "schema_version": "2"
                        }
                    }
                },
                "aws_security_group_rule.sandpit-staging-master-security-group-2056861711": {
                    "type": "aws_security_group_rule",
                    "depends_on": [
                        "aws_security_group.sandpit-staging-lb-security-group",
                        "aws_security_group.sandpit-staging-master-security-group"
                    ],
                    "primary": {
                        "id": "sgrule-28347316",
                        "attributes": {
                            "cidr_blocks.#": "0",
                            "from_port": "80",
                            "id": "sgrule-28347316",
                            "protocol": "tcp",
                            "security_group_id": "sg-2579634c",
                            "self": "false",
                            "source_security_group_id": "sg-2279634b",
                            "to_port": "80",
                            "type": "ingress"
                        },
                        "meta": {
                            "schema_version": "2"
                        }
                    }
                },
                "aws_security_group_rule.sandpit-staging-master-security-group-603013180": {
                    "type": "aws_security_group_rule",
                    "depends_on": [
                        "aws_security_group.sandpit-staging-lb-security-group",
                        "aws_security_group.sandpit-staging-master-security-group"
                    ],
                    "primary": {
                        "id": "sgrule-353510283",
                        "attributes": {
                            "cidr_blocks.#": "0",
                            "from_port": "8080",
                            "id": "sgrule-353510283",
                            "protocol": "tcp",
                            "security_group_id": "sg-2579634c",
                            "self": "false",
                            "source_security_group_id": "sg-2279634b",
                            "to_port": "8080",
                            "type": "ingress"
                        },
                        "meta": {
                            "schema_version": "2"
                        }
                    }
                },
                "aws_security_group_rule.sandpit-staging-public-slave-security-group--150178904": {
                    "type": "aws_security_group_rule",
                    "depends_on": [
                        "aws_security_group.sandpit-staging-public-slave-security-group",
                        "aws_security_group.sandpit-staging-slave-security-group"
                    ],
                    "primary": {
                        "id": "sgrule-1673031262",
                        "attributes": {
                            "cidr_blocks.#": "0",
                            "from_port": "0",
                            "id": "sgrule-1673031262",
                            "protocol": "-1",
                            "security_group_id": "sg-2779634e",
                            "self": "false",
                            "source_security_group_id": "sg-2479634d",
                            "to_port": "0",
                            "type": "ingress"
                        },
                        "meta": {
                            "schema_version": "2"
                        }
                    }
                },
                "aws_security_group_rule.sandpit-staging-public-slave-security-group--1681458695": {
                    "type": "aws_security_group_rule",
                    "depends_on": [
                        "aws_security_group.sandpit-staging-public-slave-security-group"
                    ],
                    "primary": {
                        "id": "sgrule-1542928556",
                        "attributes": {
                            "cidr_blocks.#": "0",
                            "from_port": "0",
                            "id": "sgrule-1542928556",
                            "protocol": "-1",
                            "security_group_id": "sg-2779634e",
                            "self": "false",
                            "source_security_group_id": "sg-2779634e",
                            "to_port": "0",
                            "type": "ingress"
                        },
                        "meta": {
                            "schema_version": "2"
                        }
                    }
                },
                "aws_security_group_rule.sandpit-staging-public-slave-security-group--75623017": {
                    "type": "aws_security_group_rule",
                    "depends_on": [
                        "aws_security_group.sandpit-staging-public-slave-security-group"
                    ],
                    "primary": {
                        "id": "sgrule-3431202292",
                        "attributes": {
                            "cidr_blocks.#": "1",
                            "cidr_blocks.0": "0.0.0.0/0",
                            "from_port": "23",
                            "id": "sgrule-3431202292",
                            "protocol": "udp",
                            "security_group_id": "sg-2779634e",
                            "self": "false",
                            "to_port": "5050",
                            "type": "ingress"
                        },
                        "meta": {
                            "schema_version": "2"
                        }
                    }
                },
                "aws_security_group_rule.sandpit-staging-public-slave-security-group--839671011": {
                    "type": "aws_security_group_rule",
                    "depends_on": [
                        "aws_security_group.sandpit-staging-public-slave-security-group"
                    ],
                    "primary": {
                        "id": "sgrule-1641097975",
                        "attributes": {
                            "cidr_blocks.#": "1",
                            "cidr_blocks.0": "172.20.0.0/20",
                            "from_port": "22",
                            "id": "sgrule-1641097975",
                            "protocol": "tcp",
                            "security_group_id": "sg-2779634e",
                            "self": "false",
                            "to_port": "22",
                            "type": "ingress"
                        },
                        "meta": {
                            "schema_version": "2"
                        }
                    }
                },
                "aws_security_group_rule.sandpit-staging-public-slave-security-group-1102616849": {
                    "type": "aws_security_group_rule",
                    "depends_on": [
                        "aws_security_group.sandpit-staging-public-slave-security-group"
                    ],
                    "primary": {
                        "id": "sgrule-3954455070",
                        "attributes": {
                            "cidr_blocks.#": "1",
                            "cidr_blocks.0": "0.0.0.0/0",
                            "from_port": "0",
                            "id": "sgrule-3954455070",
                            "protocol": "tcp",
                            "security_group_id": "sg-2779634e",
                            "self": "false",
                            "to_port": "21",
                            "type": "ingress"
                        },
                        "meta": {
                            "schema_version": "2"
                        }
                    }
                },
                "aws_security_group_rule.sandpit-staging-public-slave-security-group-1445014570": {
                    "type": "aws_security_group_rule",
                    "depends_on": [
                        "aws_security_group.sandpit-staging-public-slave-security-group"
                    ],
                    "primary": {
                        "id": "sgrule-1120253562",
                        "attributes": {
                            "cidr_blocks.#": "1",
                            "cidr_blocks.0": "0.0.0.0/0",
                            "from_port": "5052",
                            "id": "sgrule-1120253562",
                            "protocol": "udp",
                            "security_group_id": "sg-2779634e",
                            "self": "false",
                            "to_port": "65535",
                            "type": "ingress"
                        },
                        "meta": {
                            "schema_version": "2"
                        }
                    }
                },
                "aws_security_group_rule.sandpit-staging-public-slave-security-group-1796684383": {
                    "type": "aws_security_group_rule",
                    "depends_on": [
                        "aws_security_group.sandpit-staging-master-security-group",
                        "aws_security_group.sandpit-staging-public-slave-security-group"
                    ],
                    "primary": {
                        "id": "sgrule-1905028248",
                        "attributes": {
                            "cidr_blocks.#": "0",
                            "from_port": "0",
                            "id": "sgrule-1905028248",
                            "protocol": "-1",
                            "security_group_id": "sg-2779634e",
                            "self": "false",
                            "source_security_group_id": "sg-2579634c",
                            "to_port": "0",
                            "type": "ingress"
                        },
                        "meta": {
                            "schema_version": "2"
                        }
                    }
                },
                "aws_security_group_rule.sandpit-staging-public-slave-security-group-1830836378": {
                    "type": "aws_security_group_rule",
                    "depends_on": [
                        "aws_security_group.sandpit-staging-public-slave-security-group"
                    ],
                    "primary": {
                        "id": "sgrule-1007310050",
                        "attributes": {
                            "cidr_blocks.#": "1",
                            "cidr_blocks.0": "0.0.0.0/0",
                            "from_port": "5052",
                            "id": "sgrule-1007310050",
                            "protocol": "tcp",
                            "security_group_id": "sg-2779634e",
                            "self": "false",
                            "to_port": "65535",
                            "type": "ingress"
                        },
                        "meta": {
                            "schema_version": "2"
                        }
                    }
                },
                "aws_security_group_rule.sandpit-staging-public-slave-security-group-2085536330": {
                    "type": "aws_security_group_rule",
                    "depends_on": [
                        "aws_security_group.sandpit-staging-public-slave-security-group"
                    ],
                    "primary": {
                        "id": "sgrule-2991333228",
                        "attributes": {
                            "cidr_blocks.#": "1",
                            "cidr_blocks.0": "0.0.0.0/0",
                            "from_port": "23",
                            "id": "sgrule-2991333228",
                            "protocol": "tcp",
                            "security_group_id": "sg-2779634e",
                            "self": "false",
                            "to_port": "5050",
                            "type": "ingress"
                        },
                        "meta": {
                            "schema_version": "2"
                        }
                    }
                },
                "aws_security_group_rule.sandpit-staging-public-slave-security-group-290419564": {
                    "type": "aws_security_group_rule",
                    "depends_on": [
                        "aws_security_group.sandpit-staging-public-slave-security-group"
                    ],
                    "primary": {
                        "id": "sgrule-2507919494",
                        "attributes": {
                            "cidr_blocks.#": "1",
                            "cidr_blocks.0": "0.0.0.0/0",
                            "from_port": "0",
                            "id": "sgrule-2507919494",
                            "protocol": "udp",
                            "security_group_id": "sg-2779634e",
                            "self": "false",
                            "to_port": "21",
                            "type": "ingress"
                        },
                        "meta": {
                            "schema_version": "2"
                        }
                    }
                },
                "aws_security_group_rule.sandpit-staging-slave-security-group--797070190": {
                    "type": "aws_security_group_rule",
                    "depends_on": [
                        "aws_security_group.sandpit-staging-master-security-group",
                        "aws_security_group.sandpit-staging-slave-security-group"
                    ],
                    "primary": {
                        "id": "sgrule-1603191472",
                        "attributes": {
                            "cidr_blocks.#": "0",
                            "from_port": "0",
                            "id": "sgrule-1603191472",
                            "protocol": "-1",
                            "security_group_id": "sg-2479634d",
                            "self": "false",
                            "source_security_group_id": "sg-2579634c",
                            "to_port": "0",
                            "type": "ingress"
                        },
                        "meta": {
                            "schema_version": "2"
                        }
                    }
                },
                "aws_security_group_rule.sandpit-staging-slave-security-group--85537667": {
                    "type": "aws_security_group_rule",
                    "depends_on": [
                        "aws_security_group.sandpit-staging-lb-security-group",
                        "aws_security_group.sandpit-staging-slave-security-group"
                    ],
                    "primary": {
                        "id": "sgrule-1885305491",
                        "attributes": {
                            "cidr_blocks.#": "0",
                            "from_port": "2181",
                            "id": "sgrule-1885305491",
                            "protocol": "tcp",
                            "security_group_id": "sg-2479634d",
                            "self": "false",
                            "source_security_group_id": "sg-2279634b",
                            "to_port": "2181",
                            "type": "ingress"
                        },
                        "meta": {
                            "schema_version": "2"
                        }
                    }
                },
                "aws_security_group_rule.sandpit-staging-slave-security-group--891725830": {
                    "type": "aws_security_group_rule",
                    "depends_on": [
                        "aws_security_group.sandpit-staging-slave-security-group"
                    ],
                    "primary": {
                        "id": "sgrule-1304084598",
                        "attributes": {
                            "cidr_blocks.#": "0",
                            "from_port": "0",
                            "id": "sgrule-1304084598",
                            "protocol": "-1",
                            "security_group_id": "sg-2479634d",
                            "self": "false",
                            "source_security_group_id": "sg-2479634d",
                            "to_port": "0",
                            "type": "ingress"
                        },
                        "meta": {
                            "schema_version": "2"
                        }
                    }
                },
                "aws_security_group_rule.sandpit-staging-slave-security-group--897176985": {
                    "type": "aws_security_group_rule",
                    "depends_on": [
                        "aws_security_group.sandpit-staging-public-slave-security-group",
                        "aws_security_group.sandpit-staging-slave-security-group"
                    ],
                    "primary": {
                        "id": "sgrule-1979029124",
                        "attributes": {
                            "cidr_blocks.#": "0",
                            "from_port": "0",
                            "id": "sgrule-1979029124",
                            "protocol": "-1",
                            "security_group_id": "sg-2479634d",
                            "self": "false",
                            "source_security_group_id": "sg-2779634e",
                            "to_port": "0",
                            "type": "ingress"
                        },
                        "meta": {
                            "schema_version": "2"
                        }
                    }
                },
                "template_file.sandpit-staging-cassandra_deploy": {
                    "type": "template_file",
                    "primary": {
                        "id": "f828f2e347af50c6c8fa243db7784f867f26a7c4f00e00a5443c2fc32d2168f8",
                        "attributes": {
                            "id": "f828f2e347af50c6c8fa243db7784f867f26a7c4f00e00a5443c2fc32d2168f8",
                            "rendered": "{\n  \"id\": \"cassandra/production\",\n  \"instances\": 1,\n  \"cpus\": 0.5,\n  \"mem\": 512,\n  \"ports\": [0],\n  \"uris\": [\n    \"https://s3.eu-central-1.amazonaws.com/witan-cf-templates/cassandra-mesos-0.2.1-SNAPSHOT.tar.gz\",\n    \"https://downloads.mesosphere.io/java/jre-8u65-linux-x64.tar.gz\"\n  ],\n  \"env\": {\n    \"MESOS_AUTHENTICATE\": \"false\",\n    \"MESOS_ZK\": \"zk://master.mesos:2181/mesos\",\n    \"JAVA_OPTS\": \"-Xms256m -Xmx256m\",\n    \"CASSANDRA_CLUSTER_NAME\": \"dcos\",\n    \"CASSANDRA_ZK\": \"zk://master.mesos:2181/cassandra-mesos/dcos\",\n    \"CASSANDRA_NODE_COUNT\": \"2\",\n    \"CASSANDRA_RESOURCE_CPU_CORES\": \"0.1\",\n    \"CASSANDRA_RESOURCE_MEM_MB\": \"768\",\n    \"CASSANDRA_RESOURCE_DISK_MB\": \"16\",\n    \"CASSANDRA_HEALTH_CHECK_INTERVAL_SECONDS\": \"60\",\n    \"CASSANDRA_ZK_TIMEOUT_MS\": \"10000\",\n    \"CASSANDRA_SEED_COUNT\": \"1\",\n    \"CASSANDRA_DEFAULT_RACK\": \"RAC1\",\n    \"CASSANDRA_FAILOVER_TIMEOUT_SECONDS\": \"604800\",\n    \"CASSANDRA_BOOTSTRAP_GRACE_TIME_SECONDS\": \"120\",\n    \"CASSANDRA_DEFAULT_DC\": \"DC1\",\n    \"CASSANDRA_DATA_DIRECTORY\": \"/var/lib/cassandra\",\n    \"CASSANDRA_FRAMEWORK_MESOS_ROLE\": \"*\"\n  },\n  \"cmd\": \"$(pwd)/jre*/bin/java $JAVA_OPTS -classpath cassandra-mesos-framework.jar io.mesosphere.mesos.frameworks.cassandra.framework.Main\",\n  \"healthChecks\": [\n    {\n      \"gracePeriodSeconds\": 120,\n      \"intervalSeconds\": 30,\n      \"maxConsecutiveFailures\": 0,\n      \"path\": \"/health/cluster\",\n      \"portIndex\": 0,\n      \"protocol\": \"HTTP\",\n      \"timeoutSeconds\": 5\n    },\n    {\n      \"gracePeriodSeconds\": 120,\n      \"intervalSeconds\": 30,\n      \"maxConsecutiveFailures\": 3,\n      \"path\": \"/health/process\",\n      \"portIndex\": 0,\n      \"protocol\": \"HTTP\",\n      \"timeoutSeconds\": 5\n    }\n  ]\n}\n",
                            "template": "{\n  \"id\": \"cassandra/production\",\n  \"instances\": 1,\n  \"cpus\": 0.5,\n  \"mem\": 512,\n  \"ports\": [0],\n  \"uris\": [\n    \"https://s3.eu-central-1.amazonaws.com/witan-cf-templates/cassandra-mesos-0.2.1-SNAPSHOT.tar.gz\",\n    \"https://downloads.mesosphere.io/java/jre-8u65-linux-x64.tar.gz\"\n  ],\n  \"env\": {\n    \"MESOS_AUTHENTICATE\": \"false\",\n    \"MESOS_ZK\": \"zk://master.mesos:2181/mesos\",\n    \"JAVA_OPTS\": \"-Xms256m -Xmx256m\",\n    \"CASSANDRA_CLUSTER_NAME\": \"dcos\",\n    \"CASSANDRA_ZK\": \"zk://master.mesos:2181/cassandra-mesos/dcos\",\n    \"CASSANDRA_NODE_COUNT\": \"${cassandra_node_count}\",\n    \"CASSANDRA_RESOURCE_CPU_CORES\": \"0.1\",\n    \"CASSANDRA_RESOURCE_MEM_MB\": \"768\",\n    \"CASSANDRA_RESOURCE_DISK_MB\": \"16\",\n    \"CASSANDRA_HEALTH_CHECK_INTERVAL_SECONDS\": \"60\",\n    \"CASSANDRA_ZK_TIMEOUT_MS\": \"10000\",\n    \"CASSANDRA_SEED_COUNT\": \"${cassandra_seed_count}\",\n    \"CASSANDRA_DEFAULT_RACK\": \"RAC1\",\n    \"CASSANDRA_FAILOVER_TIMEOUT_SECONDS\": \"604800\",\n    \"CASSANDRA_BOOTSTRAP_GRACE_TIME_SECONDS\": \"120\",\n    \"CASSANDRA_DEFAULT_DC\": \"DC1\",\n    \"CASSANDRA_DATA_DIRECTORY\": \"/var/lib/cassandra\",\n    \"CASSANDRA_FRAMEWORK_MESOS_ROLE\": \"*\"\n  },\n  \"cmd\": \"$(pwd)/jre*/bin/java $JAVA_OPTS -classpath cassandra-mesos-framework.jar io.mesosphere.mesos.frameworks.cassandra.framework.Main\",\n  \"healthChecks\": [\n    {\n      \"gracePeriodSeconds\": 120,\n      \"intervalSeconds\": 30,\n      \"maxConsecutiveFailures\": 0,\n      \"path\": \"/health/cluster\",\n      \"portIndex\": 0,\n      \"protocol\": \"HTTP\",\n      \"timeoutSeconds\": 5\n    },\n    {\n      \"gracePeriodSeconds\": 120,\n      \"intervalSeconds\": 30,\n      \"maxConsecutiveFailures\": 3,\n      \"path\": \"/health/process\",\n      \"portIndex\": 0,\n      \"protocol\": \"HTTP\",\n      \"timeoutSeconds\": 5\n    }\n  ]\n}\n",
                            "vars.#": "2",
                            "vars.cassandra_node_count": "2",
                            "vars.cassandra_seed_count": "1"
                        }
                    }
                },
                "template_file.sandpit-staging-dcos-cli-install": {
                    "type": "template_file",
                    "depends_on": [
                        "aws_elb.sandpit-staging-internal-lb"
                    ],
                    "primary": {
                        "id": "63b254eba0b27476d7c6f1d8047ba080b69300b9adb618a053f2d5fc699ebbf3",
                        "attributes": {
                            "id": "63b254eba0b27476d7c6f1d8047ba080b69300b9adb618a053f2d5fc699ebbf3",
                            "rendered": "mkdir -p dcos \u0026\u0026 cd dcos \u0026\u0026\ncurl -O https://downloads.mesosphere.com/dcos-cli/install.sh \u0026\u0026\nbash ./install.sh . http://internal-sandpit-staging-internal-lb-1023536621.eu-central-1.elb.amazonaws.com \u0026\u0026\nsource ./bin/env-setup\n",
                            "template": "mkdir -p dcos \u0026\u0026 cd dcos \u0026\u0026\ncurl -O https://downloads.mesosphere.com/dcos-cli/install.sh \u0026\u0026\nbash ./install.sh . http://${internal-lb} \u0026\u0026\nsource ./bin/env-setup\n",
                            "vars.#": "1",
                            "vars.internal-lb": "internal-sandpit-staging-internal-lb-1023536621.eu-central-1.elb.amazonaws.com"
                        }
                    }
                },
                "template_file.sandpit-staging-deploy-sh": {
                    "type": "template_file",
                    "depends_on": [
                        "aws_elb.sandpit-staging-internal-lb"
                    ],
                    "primary": {
                        "id": "c593b687961dae299d18576fbf5e8d308c9790350979ceb9e2655cf1e706a895",
                        "attributes": {
                            "id": "c593b687961dae299d18576fbf5e8d308c9790350979ceb9e2655cf1e706a895",
                            "rendered": "#!/usr/bin/env bash\n\nMARATHON_HOST=internal-sandpit-staging-internal-lb-1023536621.eu-central-1.elb.amazonaws.com\nENVIRONMENT=staging\n# using deployment service sebastopol\nNAME=$1\nJSON_TEMPLATE=$2\nTAG=$3\nsed -e \"s/@@TAG@@/$TAG/\" -e \"s/@@ENVIRONMENT@@/$ENVIRONMENT/\" $JSON_TEMPLATE \u003e deploy.json\n\necho \"deleting $NAME app ...\"\ncurl -X delete http://$MARATHON_HOST:8080/v2/apps/$NAME\n\n# we want curl to output something we can use to indicate success/failure\necho \"redeploying $NAME app ...\"\nSTATUS=$(curl -s -o /dev/null -w \"%{http_code}\" -X POST http://$MARATHON_HOST:8080/v2/apps -H \"Content-Type: application/json\" --data-binary \"@deploy.json\")\n\necho \"HTTP code \" $STATUS\nif [ $STATUS == \"201\" ]\nthen exit 0\nelse exit 1\nfi\n",
                            "template": "#!/usr/bin/env bash\n\nMARATHON_HOST=${internal-lb}\nENVIRONMENT=${cluster-name}\n# using deployment service sebastopol\nNAME=$1\nJSON_TEMPLATE=$2\nTAG=$3\nsed -e \"s/@@TAG@@/$TAG/\" -e \"s/@@ENVIRONMENT@@/$ENVIRONMENT/\" $JSON_TEMPLATE \u003e deploy.json\n\necho \"deleting $NAME app ...\"\ncurl -X delete http://$MARATHON_HOST:8080/v2/apps/$NAME\n\n# we want curl to output something we can use to indicate success/failure\necho \"redeploying $NAME app ...\"\nSTATUS=$(curl -s -o /dev/null -w \"%{http_code}\" -X POST http://$MARATHON_HOST:8080/v2/apps -H \"Content-Type: application/json\" --data-binary \"@deploy.json\")\n\necho \"HTTP code \" $STATUS\nif [ $STATUS == \"201\" ]\nthen exit 0\nelse exit 1\nfi\n",
                            "vars.#": "2",
                            "vars.cluster-name": "staging",
                            "vars.internal-lb": "internal-sandpit-staging-internal-lb-1023536621.eu-central-1.elb.amazonaws.com"
                        }
                    }
                },
                "template_file.sandpit-staging-master-user-data": {
                    "type": "template_file",
                    "depends_on": [
                        "aws_elb.sandpit-staging-internal-lb",
                        "aws_iam_access_key.sandpit-staging-host-key",
                        "aws_iam_access_key.sandpit-staging-host-key",
                        "aws_iam_role.sandpit-staging-master-role",
                        "aws_iam_role.sandpit-staging-slave-role"
                    ],
                    "primary": {
                        "id": "698f7f0755ce1fc9269b1694b8d26a0a132b654f032caef4f3d6092b6b2f3b02",
                        "attributes": {
                            "id": "698f7f0755ce1fc9269b1694b8d26a0a132b654f032caef4f3d6092b6b2f3b02",
                            "rendered": "#cloud-config\ncoreos:\n  units:\n  - name: etcd.service\n    command: stop\n    mask: true\n  - name: update-engine.service\n    command: stop\n    mask: true\n  - name: locksmithd.service\n    command: stop\n    mask: true\n  - name: systemd-resolved.service\n    command: stop\n  - name: systemd-journald.service\n    command: restart\n  - name: docker.service\n    command: restart\n    enable: true\n  - name: dcos-link-env.service\n    command: start\n    content: '[Unit]\n\n      Before=dcos.target\n\n      [Service]\n\n      Type=oneshot\n\n      StandardOutput=journal+console\n\n      StandardError=journal+console\n\n      ExecStartPre=/usr/bin/mkdir -p /etc/profile.d\n\n      ExecStart=/usr/bin/ln -sf /opt/mesosphere/environment.export /etc/profile.d/dcos.sh\n\n      '\n  - name: dcos-download.service\n    content: '[Unit]\n\n      Description=Download the DCOS\n\n      After=network-online.target\n\n      Wants=network-online.target\n\n      ConditionPathExists=!/opt/mesosphere/\n\n      [Service]\n\n      EnvironmentFile=/etc/mesosphere/setup-flags/bootstrap-id\n\n      Type=oneshot\n\n      StandardOutput=journal+console\n\n      StandardError=journal+console\n\n      ExecStartPre=/usr/bin/curl --fail --retry 20 --continue-at - --location --silent\n      --show-error --verbose --output /tmp/bootstrap.tar.xz https://downloads.mesosphere.com/dcos/stable/bootstrap/${BOOTSTRAP_ID}.bootstrap.tar.xz\n\n      ExecStartPre=/usr/bin/mkdir -p /opt/mesosphere\n\n      ExecStart=/usr/bin/tar -axf /tmp/bootstrap.tar.xz -C /opt/mesosphere\n\n      ExecStartPost=-/usr/bin/rm -f /tmp/bootstrap.tar.xz\n\n      '\n  - name: dcos-setup.service\n    command: start\n    content: '[Unit]\n\n      Description=Prep the Pkgpanda working directories for this host.\n\n      Requires=dcos-download.service\n\n      After=dcos-download.service\n\n      [Service]\n\n      Type=oneshot\n\n      StandardOutput=journal+console\n\n      StandardError=journal+console\n\n      EnvironmentFile=/opt/mesosphere/environment\n\n      ExecStart=/opt/mesosphere/bin/pkgpanda setup --no-block-systemd\n\n      [Install]\n\n      WantedBy=multi-user.target'\n    enable: true\n  - name: cadvisor.service\n    command: start\n    content: '[Unit]\n\n      Description=cAdvisor for monitoring\n\n      Requires=docker.service\n\n      After=docker.service\n\n      [Service]\n\n      User=core\n\n      TimeoutStartSec=15\n\n      ExecStartPre=-/usr/bin/docker pull mastodonc/cadvisor:latest\n\n      ExecStart=/usr/bin/docker run --name=cadvisor --label application=cadvisor --net=host\n      --volume=/:/rootfs:ro --volume=/var/run:/var/run:rw --volume=/sys:/sys:ro --volume=/var/lib/docker/:/var/lib/docker:ro\n      --publish=9922:9922  --detach=false mastodonc/cadvisor:latest -port 9922 -storage_driver=influxdb\n      -storage_driver_host=influxdb.sandpit-kixi.mesos:8086 -storage_driver_db=cadvisor_staging\n\n      ExecStop=-/usr/bin/docker stop -t 2 cadvisor; /usr/bin/docker rm -f cadvisor\n\n      '\n    enable: true\n  - name: docker-cleanup.service\n    content: '[Unit]\n\n      Description=Regularly cleanup unused docker images\n\n\n      [Service]\n\n      Type=oneshot\n\n      ExecStartPre=-/usr/bin/bash -c \"/usr/bin/docker rm $(/usr/bin/docker ps -a -q)\"\n\n      ExecStart=-/usr/bin/bash -c \"/usr/bin/docker rmi $(/usr/bin/docker images -a\n      -q)\"'\n  - name: docker-cleanup.timer\n    command: start\n    content: '[Unit]\n\n      Description=Run docker-cleanup once a day at 1am\n\n\n      [Timer]\n\n      OnCalendar=*-*-* 01:00:00\n\n      Unit=docker-cleanup.service\n\n\n      [Install]\n\n      WantedBy=timers.target'\n  - name: install-confd.service\n    command: start\n    content: '[Unit]\n\n      Description=download and install confd\n\n      After=network-online.target\n\n      Wants=network-online.target\n\n      [Service]\n\n      Type=oneshot\n\n      StandardOutput=journal+console\n\n      StandardError=journal+console\n\n      TimeoutStartSec=10\n\n      ExecStartPre=/usr/bin/curl --fail --retry 20 --location --silent --show-error\n      --verbose --output /tmp/confd-0.11.0 https://s3.eu-central-1.amazonaws.com/witan-cf-templates/confd-0.11.0-linux-amd64;\n      /usr/bin/mkdir -p /opt/mesosphere/bin; /usr/bin/mv /tmp/confd-0.11.0 /opt/mesosphere/bin/;\n      /usr/bin/ln -s /opt/mesosphere/bin/confd-0.11.0 /opt/mesosphere/bin/confd\n\n      ExecStartPre=/usr/bin/mkdir -p /etc/confd/conf.d\n\n      ExecStartPre=/usr/bin/mkdir -p /etc/confd/templates\n\n      ExecStart=/usr/bin/chmod +x /opt/mesosphere/bin/confd-0.11.0\n\n      ExecStartPost=-/usr/bin/rm -f /tmp/confd-0.11.0\n\n      '\n  - name: confd.service\n    command: start\n    content: '[Unit]\n\n      Description=running confd\n\n      After=multi-user.target\n\n      Wants=multi-user.target\n\n\n      [Service]\n\n      Restart=always\n\n      StandardOutput=journal+console\n\n      StandardError=journal+console\n\n      ExecStart=/opt/mesosphere/bin/confd -backend=zookeeper -log-level=debug -node=internal-sandpit-staging-internal-lb-1023536621.eu-central-1.elb.amazonaws.com:2181\n      -interval=60\n\n      ExecStop=-/usr/bin/pkill confd'\n    enable: true\n  - name: install-awscli.service\n    command: start\n    content: '[Unit]\n\n      Description=download and install aws-cli\n\n      After=multi-user.target\n\n      Wants=multi-user.target\n\n      [Service]\n\n      Type=oneshot\n\n      TimeoutStartSec=10\n\n      StandardOutput=journal+console\n\n      StandardError=journal+console\n\n      ExecStart=/opt/mesosphere/bin/pip install awscli\n\n      '\n    enable: true\n  - name: filebeat.service\n    command: start\n    content: '[Unit]\n\n      Description=Filebeat\n\n      Documentation=filebeat systemctl\n\n      Wants=network-online.target\n\n      After=network-online.target\n\n\n      [Service]\n\n      ExecStart=/home/core/filebeat-1.2.1-x86_64/filebeat -c /home/core/filebeat-1.2.1-x86_64/filebeat.yml\n\n      Restart=always'\n    enable: true\n  - name: nrpe.service\n    command: start\n    content: '[Unit]\n\n      Description=nrpe for alerts\n\n      Requires=docker.service\n\n      After=docker.service\n\n      [Service]\n\n      User=core\n\n      TimeoutStartSec=15\n\n      ExecStartPre=-/usr/bin/docker pull mabitt/nrpe-server\n\n      ExecStart=/usr/bin/docker run --detach=false --name nrpe-server -p 5666:5666\n      -e \"NAGIOS_SERVER=alerts.sandpit-vpc.kixi\" mabitt/nrpe-server\n\n      ExecStop=-/usr/bin/docker stop -t nrpe-server; /usr/bin/docker rm -f nrpe-server'\n    enable: true\n  update:\n    reboot-strategy: 'off'\nwrite_files:\n- path: /etc/mesosphere/setup-packages/dcos-provider-aws--setup/pkginfo.json\n  content: '{}\n\n    '\n- path: /etc/mesosphere/setup-packages/dcos-provider-aws--setup/etc/cloudenv\n  content: 'AWS_REGION=eu-central-1\n\n    AWS_STACK_ID=sandpit-staging\n\n    AWS_STACK_NAME=staging\n\n    AWS_IAM_MASTER_ROLE_NAME=sandpit-staging-master-role\n\n    AWS_IAM_SLAVE_ROLE_NAME=sandpit-staging-slave-role\n\n    AWS_ACCESS_KEY_ID=AKIAIU6KU4KHLAG5KWLA\n\n    AWS_SECRET_ACCESS_KEY=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\n\n    ZOOKEEPER_CLUSTER_SIZE=3\n\n    '\n- path: /etc/mesosphere/setup-packages/dcos-provider-aws--setup/etc/mesos-master-provider\n  content: 'MESOS_CLUSTER=staging\n\n    '\n- path: /etc/mesosphere/setup-packages/dcos-provider-aws--setup/etc/exhibitor\n  content: 'EXHIBITOR_BACKEND=AWS_S3\n\n    AWS_REGION=eu-central-1\n\n    AWS_S3_BUCKET=sandpit-staging-exhibitor-s3-bucket\n\n    AWS_S3_PREFIX=staging\n\n    '\n- path: /etc/mesosphere/setup-packages/dcos-provider-aws--setup/etc/exhibitor.properties\n  content: 'com.netflix.exhibitor.s3.access-key-id=AKIAIU6KU4KHLAG5KWLA\n\n    com.netflix.exhibitor.s3.access-secret-key=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\n\n    '\n- path: /etc/mesosphere/setup-packages/dcos-provider-aws--setup/etc/dns_config\n  content: 'MASTER_SOURCE=exhibitor\n\n    EXHIBITOR_ADDRESS=internal-sandpit-staging-internal-lb-1023536621.eu-central-1.elb.amazonaws.com\n\n    RESOLVERS=172.20.0.2\n\n    '\n- path: /etc/mesosphere/cluster-id\n  content: sandpit-staging\n  permissions: '0644'\n- path: /etc/mesosphere/setup-flags/repository-url\n  content: 'https://downloads.mesosphere.com/dcos/stable\n\n    '\n  owner: root\n  permissions: 420\n- path: /etc/mesosphere/setup-flags/bootstrap-id\n  content: BOOTSTRAP_ID=18d094b1648521b017622180e3a8e05788a81e80\n  owner: root\n  permissions: 420\n- path: /etc/mesosphere/setup-flags/cluster-packages.json\n  content: '[\"dcos-config--setup_39bcd04b14a990a870cdff4543566e78d7507ba5\", \"dcos-metadata--setup_39bcd04b14a990a870cdff4543566e78d7507ba5\"]\n\n    '\n  owner: root\n  permissions: 420\n- path: /etc/systemd/journald.conf.d/dcos.conf\n  content: '[Journal]\n\n    MaxLevelConsole=warning\n\n    '\n  owner: root\n- path: /etc/systemd/journal-upload.conf\n  content: '[Upload]\n\n    URL=http://logstash.mastodonc.net:12201\n\n    '\n  owner: root\n- path: /etc/confd/conf.d/ssh-authorized-keys.toml\n  content: '[template]\n\n    src = \"ssh-authorized-keys.tmpl\"\n\n    dest = \"/home/core/.ssh/authorized_keys.d/extra-users\"\n\n    owner = \"core\"\n\n    mode=\"0600\"\n\n    keys = [\"/ssh/authorized-keys\"]\n\n    reload_cmd = \"/usr/bin/update-ssh-keys\"\n\n    '\n- path: /etc/confd/templates/ssh-authorized-keys.tmpl\n  content: '{{range getvs \"/ssh/authorized-keys/*\"}}{{.}}\n\n    {{end}}'\n- path: /etc/mesosphere/roles/master\n  content: ''\n- path: /etc/mesosphere/roles/aws_master\n  content: ''\n- path: /etc/mesosphere/roles/aws\n  content: ''\n",
                            "template": "#cloud-config\ncoreos:\n  units:\n  - name: etcd.service\n    command: stop\n    mask: true\n  - name: update-engine.service\n    command: stop\n    mask: true\n  - name: locksmithd.service\n    command: stop\n    mask: true\n  - name: systemd-resolved.service\n    command: stop\n  - name: systemd-journald.service\n    command: restart\n  - name: docker.service\n    command: restart\n    enable: true\n  - name: dcos-link-env.service\n    command: start\n    content: '[Unit]\n\n      Before=dcos.target\n\n      [Service]\n\n      Type=oneshot\n\n      StandardOutput=journal+console\n\n      StandardError=journal+console\n\n      ExecStartPre=/usr/bin/mkdir -p /etc/profile.d\n\n      ExecStart=/usr/bin/ln -sf /opt/mesosphere/environment.export /etc/profile.d/dcos.sh\n\n      '\n  - name: dcos-download.service\n    content: '[Unit]\n\n      Description=Download the DCOS\n\n      After=network-online.target\n\n      Wants=network-online.target\n\n      ConditionPathExists=!/opt/mesosphere/\n\n      [Service]\n\n      EnvironmentFile=/etc/mesosphere/setup-flags/bootstrap-id\n\n      Type=oneshot\n\n      StandardOutput=journal+console\n\n      StandardError=journal+console\n\n      ExecStartPre=/usr/bin/curl --fail --retry 20 --continue-at - --location --silent\n      --show-error --verbose --output /tmp/bootstrap.tar.xz https://downloads.mesosphere.com/dcos/stable/bootstrap/$${BOOTSTRAP_ID}.bootstrap.tar.xz\n\n      ExecStartPre=/usr/bin/mkdir -p /opt/mesosphere\n\n      ExecStart=/usr/bin/tar -axf /tmp/bootstrap.tar.xz -C /opt/mesosphere\n\n      ExecStartPost=-/usr/bin/rm -f /tmp/bootstrap.tar.xz\n\n      '\n  - name: dcos-setup.service\n    command: start\n    content: '[Unit]\n\n      Description=Prep the Pkgpanda working directories for this host.\n\n      Requires=dcos-download.service\n\n      After=dcos-download.service\n\n      [Service]\n\n      Type=oneshot\n\n      StandardOutput=journal+console\n\n      StandardError=journal+console\n\n      EnvironmentFile=/opt/mesosphere/environment\n\n      ExecStart=/opt/mesosphere/bin/pkgpanda setup --no-block-systemd\n\n      [Install]\n\n      WantedBy=multi-user.target'\n    enable: true\n  - name: cadvisor.service\n    command: start\n    content: '[Unit]\n\n      Description=cAdvisor for monitoring\n\n      Requires=docker.service\n\n      After=docker.service\n\n      [Service]\n\n      User=core\n\n      TimeoutStartSec=15\n\n      ExecStartPre=-/usr/bin/docker pull mastodonc/cadvisor:latest\n\n      ExecStart=/usr/bin/docker run --name=cadvisor --label application=cadvisor --net=host\n      --volume=/:/rootfs:ro --volume=/var/run:/var/run:rw --volume=/sys:/sys:ro --volume=/var/lib/docker/:/var/lib/docker:ro\n      --publish=9922:9922  --detach=false mastodonc/cadvisor:latest -port 9922 -storage_driver=influxdb\n      -storage_driver_host=${influxdb-dns}:8086 -storage_driver_db=cadvisor_${cluster-name}\n\n      ExecStop=-/usr/bin/docker stop -t 2 cadvisor; /usr/bin/docker rm -f cadvisor\n\n      '\n    enable: true\n  - name: docker-cleanup.service\n    content: '[Unit]\n\n      Description=Regularly cleanup unused docker images\n\n\n      [Service]\n\n      Type=oneshot\n\n      ExecStartPre=-/usr/bin/bash -c \"/usr/bin/docker rm $(/usr/bin/docker ps -a -q)\"\n\n      ExecStart=-/usr/bin/bash -c \"/usr/bin/docker rmi $(/usr/bin/docker images -a\n      -q)\"'\n  - name: docker-cleanup.timer\n    command: start\n    content: '[Unit]\n\n      Description=Run docker-cleanup once a day at 1am\n\n\n      [Timer]\n\n      OnCalendar=*-*-* 01:00:00\n\n      Unit=docker-cleanup.service\n\n\n      [Install]\n\n      WantedBy=timers.target'\n  - name: install-confd.service\n    command: start\n    content: '[Unit]\n\n      Description=download and install confd\n\n      After=network-online.target\n\n      Wants=network-online.target\n\n      [Service]\n\n      Type=oneshot\n\n      StandardOutput=journal+console\n\n      StandardError=journal+console\n\n      TimeoutStartSec=10\n\n      ExecStartPre=/usr/bin/curl --fail --retry 20 --location --silent --show-error\n      --verbose --output /tmp/confd-0.11.0 https://s3.eu-central-1.amazonaws.com/witan-cf-templates/confd-0.11.0-linux-amd64;\n      /usr/bin/mkdir -p /opt/mesosphere/bin; /usr/bin/mv /tmp/confd-0.11.0 /opt/mesosphere/bin/;\n      /usr/bin/ln -s /opt/mesosphere/bin/confd-0.11.0 /opt/mesosphere/bin/confd\n\n      ExecStartPre=/usr/bin/mkdir -p /etc/confd/conf.d\n\n      ExecStartPre=/usr/bin/mkdir -p /etc/confd/templates\n\n      ExecStart=/usr/bin/chmod +x /opt/mesosphere/bin/confd-0.11.0\n\n      ExecStartPost=-/usr/bin/rm -f /tmp/confd-0.11.0\n\n      '\n  - name: confd.service\n    command: start\n    content: '[Unit]\n\n      Description=running confd\n\n      After=multi-user.target\n\n      Wants=multi-user.target\n\n\n      [Service]\n\n      Restart=always\n\n      StandardOutput=journal+console\n\n      StandardError=journal+console\n\n      ExecStart=/opt/mesosphere/bin/confd -backend=zookeeper -log-level=debug -node=${internal-lb-dns}:2181\n      -interval=60\n\n      ExecStop=-/usr/bin/pkill confd'\n    enable: true\n  - name: install-awscli.service\n    command: start\n    content: '[Unit]\n\n      Description=download and install aws-cli\n\n      After=multi-user.target\n\n      Wants=multi-user.target\n\n      [Service]\n\n      Type=oneshot\n\n      TimeoutStartSec=10\n\n      StandardOutput=journal+console\n\n      StandardError=journal+console\n\n      ExecStart=/opt/mesosphere/bin/pip install awscli\n\n      '\n    enable: true\n  - name: filebeat.service\n    command: start\n    content: '[Unit]\n\n      Description=Filebeat\n\n      Documentation=filebeat systemctl\n\n      Wants=network-online.target\n\n      After=network-online.target\n\n\n      [Service]\n\n      ExecStart=/home/core/filebeat-1.2.1-x86_64/filebeat -c /home/core/filebeat-1.2.1-x86_64/filebeat.yml\n\n      Restart=always'\n    enable: true\n  - name: nrpe.service\n    command: start\n    content: '[Unit]\n\n      Description=nrpe for alerts\n\n      Requires=docker.service\n\n      After=docker.service\n\n      [Service]\n\n      User=core\n\n      TimeoutStartSec=15\n\n      ExecStartPre=-/usr/bin/docker pull mabitt/nrpe-server\n\n      ExecStart=/usr/bin/docker run --detach=false --name nrpe-server -p 5666:5666\n      -e \"NAGIOS_SERVER=${alerts-server}\" mabitt/nrpe-server\n\n      ExecStop=-/usr/bin/docker stop -t nrpe-server; /usr/bin/docker rm -f nrpe-server'\n    enable: true\n  update:\n    reboot-strategy: 'off'\nwrite_files:\n- path: /etc/mesosphere/setup-packages/dcos-provider-aws--setup/pkginfo.json\n  content: '{}\n\n    '\n- path: /etc/mesosphere/setup-packages/dcos-provider-aws--setup/etc/cloudenv\n  content: 'AWS_REGION=${aws-region}\n\n    AWS_STACK_ID=${cluster-id}\n\n    AWS_STACK_NAME=${cluster-name}\n\n    AWS_IAM_MASTER_ROLE_NAME=${master-role}\n\n    AWS_IAM_SLAVE_ROLE_NAME=${slave-role}\n\n    AWS_ACCESS_KEY_ID=${aws-access-key}\n\n    AWS_SECRET_ACCESS_KEY=${aws-secret-access-key}\n\n    ZOOKEEPER_CLUSTER_SIZE=${number-of-masters}\n\n    '\n- path: /etc/mesosphere/setup-packages/dcos-provider-aws--setup/etc/mesos-master-provider\n  content: 'MESOS_CLUSTER=${cluster-name}\n\n    '\n- path: /etc/mesosphere/setup-packages/dcos-provider-aws--setup/etc/exhibitor\n  content: 'EXHIBITOR_BACKEND=AWS_S3\n\n    AWS_REGION=${aws-region}\n\n    AWS_S3_BUCKET=${exhibitor-s3-bucket}\n\n    AWS_S3_PREFIX=${cluster-name}\n\n    '\n- path: /etc/mesosphere/setup-packages/dcos-provider-aws--setup/etc/exhibitor.properties\n  content: 'com.netflix.exhibitor.s3.access-key-id=${aws-access-key}\n\n    com.netflix.exhibitor.s3.access-secret-key=${aws-secret-access-key}\n\n    '\n- path: /etc/mesosphere/setup-packages/dcos-provider-aws--setup/etc/dns_config\n  content: 'MASTER_SOURCE=exhibitor\n\n    EXHIBITOR_ADDRESS=${internal-lb-dns}\n\n    RESOLVERS=${fallback-dns}\n\n    '\n- path: /etc/mesosphere/cluster-id\n  content: ${cluster-id}\n  permissions: '0644'\n- path: /etc/mesosphere/setup-flags/repository-url\n  content: 'https://downloads.mesosphere.com/dcos/stable\n\n    '\n  owner: root\n  permissions: 420\n- path: /etc/mesosphere/setup-flags/bootstrap-id\n  content: BOOTSTRAP_ID=18d094b1648521b017622180e3a8e05788a81e80\n  owner: root\n  permissions: 420\n- path: /etc/mesosphere/setup-flags/cluster-packages.json\n  content: '[\"dcos-config--setup_39bcd04b14a990a870cdff4543566e78d7507ba5\", \"dcos-metadata--setup_39bcd04b14a990a870cdff4543566e78d7507ba5\"]\n\n    '\n  owner: root\n  permissions: 420\n- path: /etc/systemd/journald.conf.d/dcos.conf\n  content: '[Journal]\n\n    MaxLevelConsole=warning\n\n    '\n  owner: root\n- path: /etc/systemd/journal-upload.conf\n  content: '[Upload]\n\n    URL=http://logstash.mastodonc.net:12201\n\n    '\n  owner: root\n- path: /etc/confd/conf.d/ssh-authorized-keys.toml\n  content: '[template]\n\n    src = \"ssh-authorized-keys.tmpl\"\n\n    dest = \"/home/core/.ssh/authorized_keys.d/extra-users\"\n\n    owner = \"core\"\n\n    mode=\"0600\"\n\n    keys = [\"/ssh/authorized-keys\"]\n\n    reload_cmd = \"/usr/bin/update-ssh-keys\"\n\n    '\n- path: /etc/confd/templates/ssh-authorized-keys.tmpl\n  content: '{{range getvs \"/ssh/authorized-keys/*\"}}{{.}}\n\n    {{end}}'\n- path: /etc/mesosphere/roles/master\n  content: ''\n- path: /etc/mesosphere/roles/aws_master\n  content: ''\n- path: /etc/mesosphere/roles/aws\n  content: ''\n",
                            "vars.#": "15",
                            "vars.alerts-server": "alerts.sandpit-vpc.kixi",
                            "vars.aws-access-key": "AKIAIU6KU4KHLAG5KWLA",
                            "vars.aws-region": "eu-central-1",
                            "vars.aws-secret-access-key": "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",
                            "vars.cluster-id": "sandpit-staging",
                            "vars.cluster-name": "staging",
                            "vars.exhibitor-s3-bucket": "sandpit-staging-exhibitor-s3-bucket",
                            "vars.fallback-dns": "172.20.0.2",
                            "vars.influxdb-dns": "influxdb.sandpit-kixi.mesos",
                            "vars.internal-lb-dns": "internal-sandpit-staging-internal-lb-1023536621.eu-central-1.elb.amazonaws.com",
                            "vars.master-role": "sandpit-staging-master-role",
                            "vars.mesos-dns": "127.0.0.1",
                            "vars.number-of-masters": "3",
                            "vars.server-group": "sandpit-staging-masters",
                            "vars.slave-role": "sandpit-staging-slave-role"
                        }
                    }
                },
                "template_file.sandpit-staging-open-mesos-admin": {
                    "type": "template_file",
                    "depends_on": [
                        "aws_elb.sandpit-staging-internal-lb"
                    ],
                    "primary": {
                        "id": "e773426d8bd2eb67c1f132571f4c255b3fecb1394afb0106aa8572323d2f13b7",
                        "attributes": {
                            "id": "e773426d8bd2eb67c1f132571f4c255b3fecb1394afb0106aa8572323d2f13b7",
                            "rendered": "open http://internal-sandpit-staging-internal-lb-1023536621.eu-central-1.elb.amazonaws.com",
                            "template": "open http://internal-sandpit-staging-internal-lb-1023536621.eu-central-1.elb.amazonaws.com"
                        }
                    }
                },
                "template_file.sandpit-staging-public-slave-user-data": {
                    "type": "template_file",
                    "depends_on": [
                        "aws_elb.sandpit-staging-internal-lb",
                        "aws_iam_access_key.sandpit-staging-host-key",
                        "aws_iam_access_key.sandpit-staging-host-key",
                        "aws_iam_role.sandpit-staging-master-role",
                        "aws_iam_role.sandpit-staging-slave-role"
                    ],
                    "primary": {
                        "id": "1071598f4a02fcccea011c98aac901d3317c9b1ce1c6a349b8abec4a32727f0b",
                        "attributes": {
                            "id": "1071598f4a02fcccea011c98aac901d3317c9b1ce1c6a349b8abec4a32727f0b",
                            "rendered": "#cloud-config\ncoreos:\n  units:\n  - name: etcd.service\n    command: stop\n    mask: true\n  - name: update-engine.service\n    command: stop\n    mask: true\n  - name: locksmithd.service\n    command: stop\n    mask: true\n  - name: systemd-resolved.service\n    command: stop\n  - name: systemd-journald.service\n    command: restart\n  - name: docker.service\n    command: restart\n    enable: true\n  - name: dcos-link-env.service\n    command: start\n    content: '[Unit]\n\n      Before=dcos.target\n\n      [Service]\n\n      Type=oneshot\n\n      StandardOutput=journal+console\n\n      StandardError=journal+console\n\n      ExecStartPre=/usr/bin/mkdir -p /etc/profile.d\n\n      ExecStart=/usr/bin/ln -sf /opt/mesosphere/environment.export /etc/profile.d/dcos.sh\n\n      '\n  - name: dcos-download.service\n    content: '[Unit]\n\n      Description=Download the DCOS\n\n      After=network-online.target\n\n      Wants=network-online.target\n\n      ConditionPathExists=!/opt/mesosphere/\n\n      [Service]\n\n      EnvironmentFile=/etc/mesosphere/setup-flags/bootstrap-id\n\n      Type=oneshot\n\n      StandardOutput=journal+console\n\n      StandardError=journal+console\n\n      ExecStartPre=/usr/bin/curl --fail --retry 20 --continue-at - --location --silent\n      --show-error --verbose --output /tmp/bootstrap.tar.xz https://downloads.mesosphere.com/dcos/stable/bootstrap/${BOOTSTRAP_ID}.bootstrap.tar.xz\n\n      ExecStartPre=/usr/bin/mkdir -p /opt/mesosphere\n\n      ExecStart=/usr/bin/tar -axf /tmp/bootstrap.tar.xz -C /opt/mesosphere\n\n      ExecStartPost=-/usr/bin/rm -f /tmp/bootstrap.tar.xz\n\n      '\n  - name: dcos-setup.service\n    command: start\n    content: '[Unit]\n\n      Description=Prep the Pkgpanda working directories for this host.\n\n      Requires=dcos-download.service\n\n      After=dcos-download.service\n\n      [Service]\n\n      Type=oneshot\n\n      StandardOutput=journal+console\n\n      StandardError=journal+console\n\n      EnvironmentFile=/opt/mesosphere/environment\n\n      ExecStart=/opt/mesosphere/bin/pkgpanda setup --no-block-systemd\n\n      [Install]\n\n      WantedBy=multi-user.target'\n    enable: true\n  - name: cadvisor.service\n    command: start\n    content: '[Unit]\n\n      Description=cAdvisor for monitoring\n\n      Requires=docker.service\n\n      After=docker.service\n\n      [Service]\n\n      User=core\n\n      TimeoutStartSec=15\n\n      ExecStartPre=-/usr/bin/docker pull mastodonc/cadvisor:latest\n\n      ExecStart=/usr/bin/docker run --name=cadvisor --label application=cadvisor --net=host\n      --volume=/:/rootfs:ro --volume=/var/run:/var/run:rw --volume=/sys:/sys:ro --volume=/var/lib/docker/:/var/lib/docker:ro\n      --publish=9922:9922  --detach=false mastodonc/cadvisor:latest -port 9922 -storage_driver=influxdb\n      -storage_driver_host=influxdb.sandpit-kixi.mesos:8086 -storage_driver_db=cadvisor_staging\n\n      ExecStop=-/usr/bin/docker stop -t 2 cadvisor; /usr/bin/docker rm -f cadvisor\n\n      '\n    enable: true\n  - name: docker-cleanup.service\n    content: '[Unit]\n\n      Description=Regularly cleanup unused docker images\n\n\n      [Service]\n\n      Type=oneshot\n\n      ExecStartPre=-/usr/bin/bash -c \"/usr/bin/docker rm $(/usr/bin/docker ps -a -q)\"\n\n      ExecStart=-/usr/bin/bash -c \"/usr/bin/docker rmi $(/usr/bin/docker images -a\n      -q)\"'\n  - name: docker-cleanup.timer\n    command: start\n    content: '[Unit]\n\n      Description=Run docker-cleanup once a day at 1am\n\n\n      [Timer]\n\n      OnCalendar=*-*-* 01:00:00\n\n      Unit=docker-cleanup.service\n\n\n      [Install]\n\n      WantedBy=timers.target'\n  - name: install-confd.service\n    command: start\n    content: '[Unit]\n\n      Description=download and install confd\n\n      After=network-online.target\n\n      Wants=network-online.target\n\n      [Service]\n\n      Type=oneshot\n\n      StandardOutput=journal+console\n\n      StandardError=journal+console\n\n      TimeoutStartSec=10\n\n      ExecStartPre=/usr/bin/curl --fail --retry 20 --location --silent --show-error\n      --verbose --output /tmp/confd-0.11.0 https://s3.eu-central-1.amazonaws.com/witan-cf-templates/confd-0.11.0-linux-amd64;\n      /usr/bin/mkdir -p /opt/mesosphere/bin; /usr/bin/mv /tmp/confd-0.11.0 /opt/mesosphere/bin/;\n      /usr/bin/ln -s /opt/mesosphere/bin/confd-0.11.0 /opt/mesosphere/bin/confd\n\n      ExecStartPre=/usr/bin/mkdir -p /etc/confd/conf.d\n\n      ExecStartPre=/usr/bin/mkdir -p /etc/confd/templates\n\n      ExecStart=/usr/bin/chmod +x /opt/mesosphere/bin/confd-0.11.0\n\n      ExecStartPost=-/usr/bin/rm -f /tmp/confd-0.11.0\n\n      '\n  - name: confd.service\n    command: start\n    content: '[Unit]\n\n      Description=running confd\n\n      After=multi-user.target\n\n      Wants=multi-user.target\n\n\n      [Service]\n\n      Restart=always\n\n      StandardOutput=journal+console\n\n      StandardError=journal+console\n\n      ExecStart=/opt/mesosphere/bin/confd -backend=zookeeper -log-level=debug -node=internal-sandpit-staging-internal-lb-1023536621.eu-central-1.elb.amazonaws.com:2181\n      -interval=60\n\n      ExecStop=-/usr/bin/pkill confd'\n    enable: true\n  - name: install-awscli.service\n    command: start\n    content: '[Unit]\n\n      Description=download and install aws-cli\n\n      After=multi-user.target\n\n      Wants=multi-user.target\n\n      [Service]\n\n      Type=oneshot\n\n      TimeoutStartSec=10\n\n      StandardOutput=journal+console\n\n      StandardError=journal+console\n\n      ExecStart=/opt/mesosphere/bin/pip install awscli\n\n      '\n    enable: true\n  - name: filebeat.service\n    command: start\n    content: '[Unit]\n\n      Description=Filebeat\n\n      Documentation=filebeat systemctl\n\n      Wants=network-online.target\n\n      After=network-online.target\n\n\n      [Service]\n\n      ExecStart=/home/core/filebeat-1.2.1-x86_64/filebeat -c /home/core/filebeat-1.2.1-x86_64/filebeat.yml\n\n      Restart=always'\n    enable: true\n  - name: nrpe.service\n    command: start\n    content: '[Unit]\n\n      Description=nrpe for alerts\n\n      Requires=docker.service\n\n      After=docker.service\n\n      [Service]\n\n      User=core\n\n      TimeoutStartSec=15\n\n      ExecStartPre=-/usr/bin/docker pull mabitt/nrpe-server\n\n      ExecStart=/usr/bin/docker run --detach=false --name nrpe-server -p 5666:5666\n      -e \"NAGIOS_SERVER=alerts.sandpit-kixi.mesos\" mabitt/nrpe-server\n\n      ExecStop=-/usr/bin/docker stop -t nrpe-server; /usr/bin/docker rm -f nrpe-server'\n    enable: true\n  update:\n    reboot-strategy: 'off'\nwrite_files:\n- path: /etc/mesosphere/setup-packages/dcos-provider-aws--setup/pkginfo.json\n  content: '{}\n\n    '\n- path: /etc/mesosphere/setup-packages/dcos-provider-aws--setup/etc/cloudenv\n  content: 'AWS_REGION=eu-central-1\n\n    AWS_STACK_ID=sandpit-staging\n\n    AWS_STACK_NAME=staging\n\n    AWS_IAM_MASTER_ROLE_NAME=sandpit-staging-master-role\n\n    AWS_IAM_SLAVE_ROLE_NAME=sandpit-staging-slave-role\n\n    AWS_ACCESS_KEY_ID=AKIAIU6KU4KHLAG5KWLA\n\n    AWS_SECRET_ACCESS_KEY=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\n\n    ZOOKEEPER_CLUSTER_SIZE=3\n\n    '\n- path: /etc/mesosphere/setup-packages/dcos-provider-aws--setup/etc/mesos-master-provider\n  content: 'MESOS_CLUSTER=staging\n\n    '\n- path: /etc/mesosphere/setup-packages/dcos-provider-aws--setup/etc/exhibitor\n  content: 'EXHIBITOR_BACKEND=AWS_S3\n\n    AWS_REGION=eu-central-1\n\n    AWS_S3_BUCKET=sandpit-staging-exhibitor-s3-bucket\n\n    AWS_S3_PREFIX=staging\n\n    '\n- path: /etc/mesosphere/setup-packages/dcos-provider-aws--setup/etc/exhibitor.properties\n  content: 'com.netflix.exhibitor.s3.access-key-id=AKIAIU6KU4KHLAG5KWLA\n\n    com.netflix.exhibitor.s3.access-secret-key=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\n\n    '\n- path: /etc/mesosphere/setup-packages/dcos-provider-aws--setup/etc/dns_config\n  content: 'MASTER_SOURCE=exhibitor\n\n    EXHIBITOR_ADDRESS=internal-sandpit-staging-internal-lb-1023536621.eu-central-1.elb.amazonaws.com\n\n    RESOLVERS=172.20.0.2\n\n    '\n- path: /etc/mesosphere/cluster-id\n  content: sandpit-staging\n  permissions: '0644'\n- path: /etc/mesosphere/setup-flags/repository-url\n  content: 'https://downloads.mesosphere.com/dcos/stable\n\n    '\n  owner: root\n  permissions: 420\n- path: /etc/mesosphere/setup-flags/bootstrap-id\n  content: BOOTSTRAP_ID=18d094b1648521b017622180e3a8e05788a81e80\n  owner: root\n  permissions: 420\n- path: /etc/mesosphere/setup-flags/cluster-packages.json\n  content: '[\"dcos-config--setup_39bcd04b14a990a870cdff4543566e78d7507ba5\", \"dcos-metadata--setup_39bcd04b14a990a870cdff4543566e78d7507ba5\"]\n\n    '\n  owner: root\n  permissions: 420\n- path: /etc/systemd/journald.conf.d/dcos.conf\n  content: '[Journal]\n\n    MaxLevelConsole=warning\n\n    '\n  owner: root\n- path: /etc/systemd/journal-upload.conf\n  content: '[Upload]\n\n    URL=http://logstash.mastodonc.net:12201\n\n    '\n  owner: root\n- path: /etc/confd/conf.d/ssh-authorized-keys.toml\n  content: '[template]\n\n    src = \"ssh-authorized-keys.tmpl\"\n\n    dest = \"/home/core/.ssh/authorized_keys.d/extra-users\"\n\n    owner = \"core\"\n\n    mode=\"0600\"\n\n    keys = [\"/ssh/authorized-keys\"]\n\n    reload_cmd = \"/usr/bin/update-ssh-keys\"\n\n    '\n- path: /etc/confd/templates/ssh-authorized-keys.tmpl\n  content: '{{range getvs \"/ssh/authorized-keys/*\"}}{{.}}\n\n    {{end}}'\n- path: /etc/mesosphere/roles/slave_public\n  content: ''\n- path: /etc/mesosphere/roles/aws\n  content: ''\n",
                            "template": "#cloud-config\ncoreos:\n  units:\n  - name: etcd.service\n    command: stop\n    mask: true\n  - name: update-engine.service\n    command: stop\n    mask: true\n  - name: locksmithd.service\n    command: stop\n    mask: true\n  - name: systemd-resolved.service\n    command: stop\n  - name: systemd-journald.service\n    command: restart\n  - name: docker.service\n    command: restart\n    enable: true\n  - name: dcos-link-env.service\n    command: start\n    content: '[Unit]\n\n      Before=dcos.target\n\n      [Service]\n\n      Type=oneshot\n\n      StandardOutput=journal+console\n\n      StandardError=journal+console\n\n      ExecStartPre=/usr/bin/mkdir -p /etc/profile.d\n\n      ExecStart=/usr/bin/ln -sf /opt/mesosphere/environment.export /etc/profile.d/dcos.sh\n\n      '\n  - name: dcos-download.service\n    content: '[Unit]\n\n      Description=Download the DCOS\n\n      After=network-online.target\n\n      Wants=network-online.target\n\n      ConditionPathExists=!/opt/mesosphere/\n\n      [Service]\n\n      EnvironmentFile=/etc/mesosphere/setup-flags/bootstrap-id\n\n      Type=oneshot\n\n      StandardOutput=journal+console\n\n      StandardError=journal+console\n\n      ExecStartPre=/usr/bin/curl --fail --retry 20 --continue-at - --location --silent\n      --show-error --verbose --output /tmp/bootstrap.tar.xz https://downloads.mesosphere.com/dcos/stable/bootstrap/$${BOOTSTRAP_ID}.bootstrap.tar.xz\n\n      ExecStartPre=/usr/bin/mkdir -p /opt/mesosphere\n\n      ExecStart=/usr/bin/tar -axf /tmp/bootstrap.tar.xz -C /opt/mesosphere\n\n      ExecStartPost=-/usr/bin/rm -f /tmp/bootstrap.tar.xz\n\n      '\n  - name: dcos-setup.service\n    command: start\n    content: '[Unit]\n\n      Description=Prep the Pkgpanda working directories for this host.\n\n      Requires=dcos-download.service\n\n      After=dcos-download.service\n\n      [Service]\n\n      Type=oneshot\n\n      StandardOutput=journal+console\n\n      StandardError=journal+console\n\n      EnvironmentFile=/opt/mesosphere/environment\n\n      ExecStart=/opt/mesosphere/bin/pkgpanda setup --no-block-systemd\n\n      [Install]\n\n      WantedBy=multi-user.target'\n    enable: true\n  - name: cadvisor.service\n    command: start\n    content: '[Unit]\n\n      Description=cAdvisor for monitoring\n\n      Requires=docker.service\n\n      After=docker.service\n\n      [Service]\n\n      User=core\n\n      TimeoutStartSec=15\n\n      ExecStartPre=-/usr/bin/docker pull mastodonc/cadvisor:latest\n\n      ExecStart=/usr/bin/docker run --name=cadvisor --label application=cadvisor --net=host\n      --volume=/:/rootfs:ro --volume=/var/run:/var/run:rw --volume=/sys:/sys:ro --volume=/var/lib/docker/:/var/lib/docker:ro\n      --publish=9922:9922  --detach=false mastodonc/cadvisor:latest -port 9922 -storage_driver=influxdb\n      -storage_driver_host=${influxdb-dns}:8086 -storage_driver_db=cadvisor_${cluster-name}\n\n      ExecStop=-/usr/bin/docker stop -t 2 cadvisor; /usr/bin/docker rm -f cadvisor\n\n      '\n    enable: true\n  - name: docker-cleanup.service\n    content: '[Unit]\n\n      Description=Regularly cleanup unused docker images\n\n\n      [Service]\n\n      Type=oneshot\n\n      ExecStartPre=-/usr/bin/bash -c \"/usr/bin/docker rm $(/usr/bin/docker ps -a -q)\"\n\n      ExecStart=-/usr/bin/bash -c \"/usr/bin/docker rmi $(/usr/bin/docker images -a\n      -q)\"'\n  - name: docker-cleanup.timer\n    command: start\n    content: '[Unit]\n\n      Description=Run docker-cleanup once a day at 1am\n\n\n      [Timer]\n\n      OnCalendar=*-*-* 01:00:00\n\n      Unit=docker-cleanup.service\n\n\n      [Install]\n\n      WantedBy=timers.target'\n  - name: install-confd.service\n    command: start\n    content: '[Unit]\n\n      Description=download and install confd\n\n      After=network-online.target\n\n      Wants=network-online.target\n\n      [Service]\n\n      Type=oneshot\n\n      StandardOutput=journal+console\n\n      StandardError=journal+console\n\n      TimeoutStartSec=10\n\n      ExecStartPre=/usr/bin/curl --fail --retry 20 --location --silent --show-error\n      --verbose --output /tmp/confd-0.11.0 https://s3.eu-central-1.amazonaws.com/witan-cf-templates/confd-0.11.0-linux-amd64;\n      /usr/bin/mkdir -p /opt/mesosphere/bin; /usr/bin/mv /tmp/confd-0.11.0 /opt/mesosphere/bin/;\n      /usr/bin/ln -s /opt/mesosphere/bin/confd-0.11.0 /opt/mesosphere/bin/confd\n\n      ExecStartPre=/usr/bin/mkdir -p /etc/confd/conf.d\n\n      ExecStartPre=/usr/bin/mkdir -p /etc/confd/templates\n\n      ExecStart=/usr/bin/chmod +x /opt/mesosphere/bin/confd-0.11.0\n\n      ExecStartPost=-/usr/bin/rm -f /tmp/confd-0.11.0\n\n      '\n  - name: confd.service\n    command: start\n    content: '[Unit]\n\n      Description=running confd\n\n      After=multi-user.target\n\n      Wants=multi-user.target\n\n\n      [Service]\n\n      Restart=always\n\n      StandardOutput=journal+console\n\n      StandardError=journal+console\n\n      ExecStart=/opt/mesosphere/bin/confd -backend=zookeeper -log-level=debug -node=${internal-lb-dns}:2181\n      -interval=60\n\n      ExecStop=-/usr/bin/pkill confd'\n    enable: true\n  - name: install-awscli.service\n    command: start\n    content: '[Unit]\n\n      Description=download and install aws-cli\n\n      After=multi-user.target\n\n      Wants=multi-user.target\n\n      [Service]\n\n      Type=oneshot\n\n      TimeoutStartSec=10\n\n      StandardOutput=journal+console\n\n      StandardError=journal+console\n\n      ExecStart=/opt/mesosphere/bin/pip install awscli\n\n      '\n    enable: true\n  - name: filebeat.service\n    command: start\n    content: '[Unit]\n\n      Description=Filebeat\n\n      Documentation=filebeat systemctl\n\n      Wants=network-online.target\n\n      After=network-online.target\n\n\n      [Service]\n\n      ExecStart=/home/core/filebeat-1.2.1-x86_64/filebeat -c /home/core/filebeat-1.2.1-x86_64/filebeat.yml\n\n      Restart=always'\n    enable: true\n  - name: nrpe.service\n    command: start\n    content: '[Unit]\n\n      Description=nrpe for alerts\n\n      Requires=docker.service\n\n      After=docker.service\n\n      [Service]\n\n      User=core\n\n      TimeoutStartSec=15\n\n      ExecStartPre=-/usr/bin/docker pull mabitt/nrpe-server\n\n      ExecStart=/usr/bin/docker run --detach=false --name nrpe-server -p 5666:5666\n      -e \"NAGIOS_SERVER=${alerts-server}\" mabitt/nrpe-server\n\n      ExecStop=-/usr/bin/docker stop -t nrpe-server; /usr/bin/docker rm -f nrpe-server'\n    enable: true\n  update:\n    reboot-strategy: 'off'\nwrite_files:\n- path: /etc/mesosphere/setup-packages/dcos-provider-aws--setup/pkginfo.json\n  content: '{}\n\n    '\n- path: /etc/mesosphere/setup-packages/dcos-provider-aws--setup/etc/cloudenv\n  content: 'AWS_REGION=${aws-region}\n\n    AWS_STACK_ID=${cluster-id}\n\n    AWS_STACK_NAME=${cluster-name}\n\n    AWS_IAM_MASTER_ROLE_NAME=${master-role}\n\n    AWS_IAM_SLAVE_ROLE_NAME=${slave-role}\n\n    AWS_ACCESS_KEY_ID=${aws-access-key}\n\n    AWS_SECRET_ACCESS_KEY=${aws-secret-access-key}\n\n    ZOOKEEPER_CLUSTER_SIZE=${number-of-masters}\n\n    '\n- path: /etc/mesosphere/setup-packages/dcos-provider-aws--setup/etc/mesos-master-provider\n  content: 'MESOS_CLUSTER=${cluster-name}\n\n    '\n- path: /etc/mesosphere/setup-packages/dcos-provider-aws--setup/etc/exhibitor\n  content: 'EXHIBITOR_BACKEND=AWS_S3\n\n    AWS_REGION=${aws-region}\n\n    AWS_S3_BUCKET=${exhibitor-s3-bucket}\n\n    AWS_S3_PREFIX=${cluster-name}\n\n    '\n- path: /etc/mesosphere/setup-packages/dcos-provider-aws--setup/etc/exhibitor.properties\n  content: 'com.netflix.exhibitor.s3.access-key-id=${aws-access-key}\n\n    com.netflix.exhibitor.s3.access-secret-key=${aws-secret-access-key}\n\n    '\n- path: /etc/mesosphere/setup-packages/dcos-provider-aws--setup/etc/dns_config\n  content: 'MASTER_SOURCE=exhibitor\n\n    EXHIBITOR_ADDRESS=${internal-lb-dns}\n\n    RESOLVERS=${fallback-dns}\n\n    '\n- path: /etc/mesosphere/cluster-id\n  content: ${cluster-id}\n  permissions: '0644'\n- path: /etc/mesosphere/setup-flags/repository-url\n  content: 'https://downloads.mesosphere.com/dcos/stable\n\n    '\n  owner: root\n  permissions: 420\n- path: /etc/mesosphere/setup-flags/bootstrap-id\n  content: BOOTSTRAP_ID=18d094b1648521b017622180e3a8e05788a81e80\n  owner: root\n  permissions: 420\n- path: /etc/mesosphere/setup-flags/cluster-packages.json\n  content: '[\"dcos-config--setup_39bcd04b14a990a870cdff4543566e78d7507ba5\", \"dcos-metadata--setup_39bcd04b14a990a870cdff4543566e78d7507ba5\"]\n\n    '\n  owner: root\n  permissions: 420\n- path: /etc/systemd/journald.conf.d/dcos.conf\n  content: '[Journal]\n\n    MaxLevelConsole=warning\n\n    '\n  owner: root\n- path: /etc/systemd/journal-upload.conf\n  content: '[Upload]\n\n    URL=http://logstash.mastodonc.net:12201\n\n    '\n  owner: root\n- path: /etc/confd/conf.d/ssh-authorized-keys.toml\n  content: '[template]\n\n    src = \"ssh-authorized-keys.tmpl\"\n\n    dest = \"/home/core/.ssh/authorized_keys.d/extra-users\"\n\n    owner = \"core\"\n\n    mode=\"0600\"\n\n    keys = [\"/ssh/authorized-keys\"]\n\n    reload_cmd = \"/usr/bin/update-ssh-keys\"\n\n    '\n- path: /etc/confd/templates/ssh-authorized-keys.tmpl\n  content: '{{range getvs \"/ssh/authorized-keys/*\"}}{{.}}\n\n    {{end}}'\n- path: /etc/mesosphere/roles/slave_public\n  content: ''\n- path: /etc/mesosphere/roles/aws\n  content: ''\n",
                            "vars.#": "15",
                            "vars.alerts-server": "alerts.sandpit-kixi.mesos",
                            "vars.aws-access-key": "AKIAIU6KU4KHLAG5KWLA",
                            "vars.aws-region": "eu-central-1",
                            "vars.aws-secret-access-key": "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",
                            "vars.cluster-id": "sandpit-staging",
                            "vars.cluster-name": "staging",
                            "vars.exhibitor-s3-bucket": "sandpit-staging-exhibitor-s3-bucket",
                            "vars.fallback-dns": "172.20.0.2",
                            "vars.influxdb-dns": "influxdb.sandpit-kixi.mesos",
                            "vars.internal-lb-dns": "internal-sandpit-staging-internal-lb-1023536621.eu-central-1.elb.amazonaws.com",
                            "vars.master-role": "sandpit-staging-master-role",
                            "vars.mesos-dns": "internal-sandpit-staging-internal-lb-1023536621.eu-central-1.elb.amazonaws.com",
                            "vars.number-of-masters": "3",
                            "vars.server-group": "sandpit-staging-public-slaves",
                            "vars.slave-role": "sandpit-staging-slave-role"
                        }
                    }
                },
                "template_file.sandpit-staging-slave-user-data": {
                    "type": "template_file",
                    "depends_on": [
                        "aws_elb.sandpit-staging-internal-lb",
                        "aws_iam_access_key.sandpit-staging-host-key",
                        "aws_iam_access_key.sandpit-staging-host-key",
                        "aws_iam_role.sandpit-staging-master-role",
                        "aws_iam_role.sandpit-staging-slave-role"
                    ],
                    "primary": {
                        "id": "f83030265012126e64ca4a60a66392e945702ca1a1f9f208a69e5e64c5afa2cb",
                        "attributes": {
                            "id": "f83030265012126e64ca4a60a66392e945702ca1a1f9f208a69e5e64c5afa2cb",
                            "rendered": "#cloud-config\ncoreos:\n  units:\n  - name: etcd.service\n    command: stop\n    mask: true\n  - name: update-engine.service\n    command: stop\n    mask: true\n  - name: locksmithd.service\n    command: stop\n    mask: true\n  - name: systemd-resolved.service\n    command: stop\n  - name: systemd-journald.service\n    command: restart\n  - name: docker.service\n    command: restart\n    enable: true\n  - name: dcos-link-env.service\n    command: start\n    content: '[Unit]\n\n      Before=dcos.target\n\n      [Service]\n\n      Type=oneshot\n\n      StandardOutput=journal+console\n\n      StandardError=journal+console\n\n      ExecStartPre=/usr/bin/mkdir -p /etc/profile.d\n\n      ExecStart=/usr/bin/ln -sf /opt/mesosphere/environment.export /etc/profile.d/dcos.sh\n\n      '\n  - name: dcos-download.service\n    content: '[Unit]\n\n      Description=Download the DCOS\n\n      After=network-online.target\n\n      Wants=network-online.target\n\n      ConditionPathExists=!/opt/mesosphere/\n\n      [Service]\n\n      EnvironmentFile=/etc/mesosphere/setup-flags/bootstrap-id\n\n      Type=oneshot\n\n      StandardOutput=journal+console\n\n      StandardError=journal+console\n\n      ExecStartPre=/usr/bin/curl --fail --retry 20 --continue-at - --location --silent\n      --show-error --verbose --output /tmp/bootstrap.tar.xz https://downloads.mesosphere.com/dcos/stable/bootstrap/${BOOTSTRAP_ID}.bootstrap.tar.xz\n\n      ExecStartPre=/usr/bin/mkdir -p /opt/mesosphere\n\n      ExecStart=/usr/bin/tar -axf /tmp/bootstrap.tar.xz -C /opt/mesosphere\n\n      ExecStartPost=-/usr/bin/rm -f /tmp/bootstrap.tar.xz\n\n      '\n  - name: dcos-setup.service\n    command: start\n    content: '[Unit]\n\n      Description=Prep the Pkgpanda working directories for this host.\n\n      Requires=dcos-download.service\n\n      After=dcos-download.service\n\n      [Service]\n\n      Type=oneshot\n\n      StandardOutput=journal+console\n\n      StandardError=journal+console\n\n      EnvironmentFile=/opt/mesosphere/environment\n\n      ExecStart=/opt/mesosphere/bin/pkgpanda setup --no-block-systemd\n\n      [Install]\n\n      WantedBy=multi-user.target'\n    enable: true\n  - name: cadvisor.service\n    command: start\n    content: '[Unit]\n\n      Description=cAdvisor for monitoring\n\n      Requires=docker.service\n\n      After=docker.service\n\n      [Service]\n\n      User=core\n\n      TimeoutStartSec=15\n\n      ExecStartPre=-/usr/bin/docker pull mastodonc/cadvisor:latest\n\n      ExecStart=/usr/bin/docker run --name=cadvisor --label application=cadvisor --net=host\n      --volume=/:/rootfs:ro --volume=/var/run:/var/run:rw --volume=/sys:/sys:ro --volume=/var/lib/docker/:/var/lib/docker:ro\n      --publish=9922:9922  --detach=false mastodonc/cadvisor:latest -port 9922 -storage_driver=influxdb\n      -storage_driver_host=influxdb.sandpit-kixi.mesos:8086 -storage_driver_db=cadvisor_staging\n\n      ExecStop=-/usr/bin/docker stop -t 2 cadvisor; /usr/bin/docker rm -f cadvisor\n\n      '\n    enable: true\n  - name: docker-cleanup.service\n    content: '[Unit]\n\n      Description=Regularly cleanup unused docker images\n\n\n      [Service]\n\n      Type=oneshot\n\n      ExecStartPre=-/usr/bin/bash -c \"/usr/bin/docker rm $(/usr/bin/docker ps -a -q)\"\n\n      ExecStart=-/usr/bin/bash -c \"/usr/bin/docker rmi $(/usr/bin/docker images -a\n      -q)\"'\n  - name: docker-cleanup.timer\n    command: start\n    content: '[Unit]\n\n      Description=Run docker-cleanup once a day at 1am\n\n\n      [Timer]\n\n      OnCalendar=*-*-* 01:00:00\n\n      Unit=docker-cleanup.service\n\n\n      [Install]\n\n      WantedBy=timers.target'\n  - name: install-confd.service\n    command: start\n    content: '[Unit]\n\n      Description=download and install confd\n\n      After=network-online.target\n\n      Wants=network-online.target\n\n      [Service]\n\n      Type=oneshot\n\n      StandardOutput=journal+console\n\n      StandardError=journal+console\n\n      TimeoutStartSec=10\n\n      ExecStartPre=/usr/bin/curl --fail --retry 20 --location --silent --show-error\n      --verbose --output /tmp/confd-0.11.0 https://s3.eu-central-1.amazonaws.com/witan-cf-templates/confd-0.11.0-linux-amd64;\n      /usr/bin/mkdir -p /opt/mesosphere/bin; /usr/bin/mv /tmp/confd-0.11.0 /opt/mesosphere/bin/;\n      /usr/bin/ln -s /opt/mesosphere/bin/confd-0.11.0 /opt/mesosphere/bin/confd\n\n      ExecStartPre=/usr/bin/mkdir -p /etc/confd/conf.d\n\n      ExecStartPre=/usr/bin/mkdir -p /etc/confd/templates\n\n      ExecStart=/usr/bin/chmod +x /opt/mesosphere/bin/confd-0.11.0\n\n      ExecStartPost=-/usr/bin/rm -f /tmp/confd-0.11.0\n\n      '\n  - name: confd.service\n    command: start\n    content: '[Unit]\n\n      Description=running confd\n\n      After=multi-user.target\n\n      Wants=multi-user.target\n\n\n      [Service]\n\n      Restart=always\n\n      StandardOutput=journal+console\n\n      StandardError=journal+console\n\n      ExecStart=/opt/mesosphere/bin/confd -backend=zookeeper -log-level=debug -node=internal-sandpit-staging-internal-lb-1023536621.eu-central-1.elb.amazonaws.com:2181\n      -interval=60\n\n      ExecStop=-/usr/bin/pkill confd'\n    enable: true\n  - name: install-awscli.service\n    command: start\n    content: '[Unit]\n\n      Description=download and install aws-cli\n\n      After=multi-user.target\n\n      Wants=multi-user.target\n\n      [Service]\n\n      Type=oneshot\n\n      TimeoutStartSec=10\n\n      StandardOutput=journal+console\n\n      StandardError=journal+console\n\n      ExecStart=/opt/mesosphere/bin/pip install awscli\n\n      '\n    enable: true\n  - name: filebeat.service\n    command: start\n    content: '[Unit]\n\n      Description=Filebeat\n\n      Documentation=filebeat systemctl\n\n      Wants=network-online.target\n\n      After=network-online.target\n\n\n      [Service]\n\n      ExecStart=/home/core/filebeat-1.2.1-x86_64/filebeat -c /home/core/filebeat-1.2.1-x86_64/filebeat.yml\n\n      Restart=always'\n    enable: true\n  - name: nrpe.service\n    command: start\n    content: '[Unit]\n\n      Description=nrpe for alerts\n\n      Requires=docker.service\n\n      After=docker.service\n\n      [Service]\n\n      User=core\n\n      TimeoutStartSec=15\n\n      ExecStartPre=-/usr/bin/docker pull mabitt/nrpe-server\n\n      ExecStart=/usr/bin/docker run --detach=false --name nrpe-server -p 5666:5666\n      -e \"NAGIOS_SERVER=alerts.sandpit-kixi.mesos\" mabitt/nrpe-server\n\n      ExecStop=-/usr/bin/docker stop -t nrpe-server; /usr/bin/docker rm -f nrpe-server'\n    enable: true\n  - name: backup.service\n    content: '[Unit]\n\n      Description=Backup of cassandra database\n\n      After=multi-user.target\n\n      Wants=multi-user.target\n\n      [Service]\n\n      Type=oneshot\n\n      Environment=\"PATH=/opt/mesosphere/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/opt/bin\"\n\n      ExecStart=/home/core/cassandra-backup/backup-witan.sh\n\n      '\n  - name: backup.timer\n    command: start\n    content: '[Unit]\n\n      Description=Run backup.service once a day at 5am\n\n\n      [Timer]\n\n      OnCalendar=*-*-* 05:00:00\n\n      Unit=backup.service\n\n\n      [Install]\n\n      WantedBy=timers.target\n\n      '\n  update:\n    reboot-strategy: 'off'\nwrite_files:\n- path: /etc/mesosphere/setup-packages/dcos-provider-aws--setup/pkginfo.json\n  content: '{}\n\n    '\n- path: /etc/mesosphere/setup-packages/dcos-provider-aws--setup/etc/cloudenv\n  content: 'AWS_REGION=eu-central-1\n\n    AWS_STACK_ID=sandpit-staging\n\n    AWS_STACK_NAME=staging\n\n    AWS_IAM_MASTER_ROLE_NAME=sandpit-staging-master-role\n\n    AWS_IAM_SLAVE_ROLE_NAME=sandpit-staging-slave-role\n\n    AWS_ACCESS_KEY_ID=AKIAIU6KU4KHLAG5KWLA\n\n    AWS_SECRET_ACCESS_KEY=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\n\n    ZOOKEEPER_CLUSTER_SIZE=3\n\n    '\n- path: /etc/mesosphere/setup-packages/dcos-provider-aws--setup/etc/mesos-master-provider\n  content: 'MESOS_CLUSTER=staging\n\n    '\n- path: /etc/mesosphere/setup-packages/dcos-provider-aws--setup/etc/exhibitor\n  content: 'EXHIBITOR_BACKEND=AWS_S3\n\n    AWS_REGION=eu-central-1\n\n    AWS_S3_BUCKET=sandpit-staging-exhibitor-s3-bucket\n\n    AWS_S3_PREFIX=staging\n\n    '\n- path: /etc/mesosphere/setup-packages/dcos-provider-aws--setup/etc/exhibitor.properties\n  content: 'com.netflix.exhibitor.s3.access-key-id=AKIAIU6KU4KHLAG5KWLA\n\n    com.netflix.exhibitor.s3.access-secret-key=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\n\n    '\n- path: /etc/mesosphere/setup-packages/dcos-provider-aws--setup/etc/dns_config\n  content: 'MASTER_SOURCE=exhibitor\n\n    EXHIBITOR_ADDRESS=internal-sandpit-staging-internal-lb-1023536621.eu-central-1.elb.amazonaws.com\n\n    RESOLVERS=172.20.0.2\n\n    '\n- path: /etc/mesosphere/cluster-id\n  content: sandpit-staging\n  permissions: '0644'\n- path: /etc/mesosphere/setup-flags/repository-url\n  content: 'https://downloads.mesosphere.com/dcos/stable\n\n    '\n  owner: root\n  permissions: 420\n- path: /etc/mesosphere/setup-flags/bootstrap-id\n  content: BOOTSTRAP_ID=18d094b1648521b017622180e3a8e05788a81e80\n  owner: root\n  permissions: 420\n- path: /etc/mesosphere/setup-flags/cluster-packages.json\n  content: '[\"dcos-config--setup_39bcd04b14a990a870cdff4543566e78d7507ba5\", \"dcos-metadata--setup_39bcd04b14a990a870cdff4543566e78d7507ba5\"]\n\n    '\n  owner: root\n  permissions: 420\n- path: /etc/systemd/journald.conf.d/dcos.conf\n  content: '[Journal]\n\n    MaxLevelConsole=warning\n\n    '\n  owner: root\n- path: /etc/systemd/journal-upload.conf\n  content: '[Upload]\n\n    URL=http://logstash.mastodonc.net:12201\n\n    '\n  owner: root\n- path: /etc/confd/conf.d/ssh-authorized-keys.toml\n  content: '[template]\n\n    src = \"ssh-authorized-keys.tmpl\"\n\n    dest = \"/home/core/.ssh/authorized_keys.d/extra-users\"\n\n    owner = \"core\"\n\n    mode=\"0600\"\n\n    keys = [\"/ssh/authorized-keys\"]\n\n    reload_cmd = \"/usr/bin/update-ssh-keys\"\n\n    '\n- path: /etc/confd/templates/ssh-authorized-keys.tmpl\n  content: '{{range getvs \"/ssh/authorized-keys/*\"}}{{.}}\n\n    {{end}}'\n- path: /etc/mesosphere/roles/slave\n  content: ''\n- path: /etc/mesosphere/roles/aws\n  content: ''\n- path: /home/core/cassandra-backup/backup-witan.sh\n  content: \"#!/bin/sh\\n\\n# necessary for java location\\nexport PATH=$PATH:/opt/mesosphere/bin\\n\\\n    CASSANDRA_DIR=$(ps -A -o command | grep CassandraDaemon | grep '/var/lib' | cut\\\n    \\ -d' ' -f1 | sed -e 's#/jre1.*##')\\nCASSANDRA_DATA_DIR=/var/lib/cassandra/data\\n\\\n    NODETOOL=$(find $CASSANDRA_DIR -name nodetool -type f -perm /u+x | grep bin/nodetool)\\n\\\n    AWS=$(find /opt/mesosphere -name aws -type f -perm /u+x | grep bin/aws)\\ndirectory=$($NODETOOL\\\n    \\ snapshot witan | awk '/directory/{print $3}')\\n\\n# We assume it's worked if\\\n    \\ it tells us the directory\\nif [ -z \\\"${directory}\\\" ]; then\\n   echo \\\"Problem\\\n    \\ getting snapshot directory\\\"\\n   exit 1;\\nfi\\n\\n# We only want the snapshots\\\n    \\ dirs\\n# For filters rationale see http://docs.aws.amazon.com/cli/latest/reference/s3/index.html#use-of-exclude-and-include-filters\\n\\\n    sudo -u core $AWS --profile backup s3 sync --exclude '*' --include '*/snapshots/*'\\\n    \\ ${CASSANDRA_DATA_DIR} s3://witan-cassandra-backup/$(hostname)/ --region eu-central-1\\n\"\n  permissions: '0744'\n",
                            "template": "#cloud-config\ncoreos:\n  units:\n  - name: etcd.service\n    command: stop\n    mask: true\n  - name: update-engine.service\n    command: stop\n    mask: true\n  - name: locksmithd.service\n    command: stop\n    mask: true\n  - name: systemd-resolved.service\n    command: stop\n  - name: systemd-journald.service\n    command: restart\n  - name: docker.service\n    command: restart\n    enable: true\n  - name: dcos-link-env.service\n    command: start\n    content: '[Unit]\n\n      Before=dcos.target\n\n      [Service]\n\n      Type=oneshot\n\n      StandardOutput=journal+console\n\n      StandardError=journal+console\n\n      ExecStartPre=/usr/bin/mkdir -p /etc/profile.d\n\n      ExecStart=/usr/bin/ln -sf /opt/mesosphere/environment.export /etc/profile.d/dcos.sh\n\n      '\n  - name: dcos-download.service\n    content: '[Unit]\n\n      Description=Download the DCOS\n\n      After=network-online.target\n\n      Wants=network-online.target\n\n      ConditionPathExists=!/opt/mesosphere/\n\n      [Service]\n\n      EnvironmentFile=/etc/mesosphere/setup-flags/bootstrap-id\n\n      Type=oneshot\n\n      StandardOutput=journal+console\n\n      StandardError=journal+console\n\n      ExecStartPre=/usr/bin/curl --fail --retry 20 --continue-at - --location --silent\n      --show-error --verbose --output /tmp/bootstrap.tar.xz https://downloads.mesosphere.com/dcos/stable/bootstrap/$${BOOTSTRAP_ID}.bootstrap.tar.xz\n\n      ExecStartPre=/usr/bin/mkdir -p /opt/mesosphere\n\n      ExecStart=/usr/bin/tar -axf /tmp/bootstrap.tar.xz -C /opt/mesosphere\n\n      ExecStartPost=-/usr/bin/rm -f /tmp/bootstrap.tar.xz\n\n      '\n  - name: dcos-setup.service\n    command: start\n    content: '[Unit]\n\n      Description=Prep the Pkgpanda working directories for this host.\n\n      Requires=dcos-download.service\n\n      After=dcos-download.service\n\n      [Service]\n\n      Type=oneshot\n\n      StandardOutput=journal+console\n\n      StandardError=journal+console\n\n      EnvironmentFile=/opt/mesosphere/environment\n\n      ExecStart=/opt/mesosphere/bin/pkgpanda setup --no-block-systemd\n\n      [Install]\n\n      WantedBy=multi-user.target'\n    enable: true\n  - name: cadvisor.service\n    command: start\n    content: '[Unit]\n\n      Description=cAdvisor for monitoring\n\n      Requires=docker.service\n\n      After=docker.service\n\n      [Service]\n\n      User=core\n\n      TimeoutStartSec=15\n\n      ExecStartPre=-/usr/bin/docker pull mastodonc/cadvisor:latest\n\n      ExecStart=/usr/bin/docker run --name=cadvisor --label application=cadvisor --net=host\n      --volume=/:/rootfs:ro --volume=/var/run:/var/run:rw --volume=/sys:/sys:ro --volume=/var/lib/docker/:/var/lib/docker:ro\n      --publish=9922:9922  --detach=false mastodonc/cadvisor:latest -port 9922 -storage_driver=influxdb\n      -storage_driver_host=${influxdb-dns}:8086 -storage_driver_db=cadvisor_${cluster-name}\n\n      ExecStop=-/usr/bin/docker stop -t 2 cadvisor; /usr/bin/docker rm -f cadvisor\n\n      '\n    enable: true\n  - name: docker-cleanup.service\n    content: '[Unit]\n\n      Description=Regularly cleanup unused docker images\n\n\n      [Service]\n\n      Type=oneshot\n\n      ExecStartPre=-/usr/bin/bash -c \"/usr/bin/docker rm $(/usr/bin/docker ps -a -q)\"\n\n      ExecStart=-/usr/bin/bash -c \"/usr/bin/docker rmi $(/usr/bin/docker images -a\n      -q)\"'\n  - name: docker-cleanup.timer\n    command: start\n    content: '[Unit]\n\n      Description=Run docker-cleanup once a day at 1am\n\n\n      [Timer]\n\n      OnCalendar=*-*-* 01:00:00\n\n      Unit=docker-cleanup.service\n\n\n      [Install]\n\n      WantedBy=timers.target'\n  - name: install-confd.service\n    command: start\n    content: '[Unit]\n\n      Description=download and install confd\n\n      After=network-online.target\n\n      Wants=network-online.target\n\n      [Service]\n\n      Type=oneshot\n\n      StandardOutput=journal+console\n\n      StandardError=journal+console\n\n      TimeoutStartSec=10\n\n      ExecStartPre=/usr/bin/curl --fail --retry 20 --location --silent --show-error\n      --verbose --output /tmp/confd-0.11.0 https://s3.eu-central-1.amazonaws.com/witan-cf-templates/confd-0.11.0-linux-amd64;\n      /usr/bin/mkdir -p /opt/mesosphere/bin; /usr/bin/mv /tmp/confd-0.11.0 /opt/mesosphere/bin/;\n      /usr/bin/ln -s /opt/mesosphere/bin/confd-0.11.0 /opt/mesosphere/bin/confd\n\n      ExecStartPre=/usr/bin/mkdir -p /etc/confd/conf.d\n\n      ExecStartPre=/usr/bin/mkdir -p /etc/confd/templates\n\n      ExecStart=/usr/bin/chmod +x /opt/mesosphere/bin/confd-0.11.0\n\n      ExecStartPost=-/usr/bin/rm -f /tmp/confd-0.11.0\n\n      '\n  - name: confd.service\n    command: start\n    content: '[Unit]\n\n      Description=running confd\n\n      After=multi-user.target\n\n      Wants=multi-user.target\n\n\n      [Service]\n\n      Restart=always\n\n      StandardOutput=journal+console\n\n      StandardError=journal+console\n\n      ExecStart=/opt/mesosphere/bin/confd -backend=zookeeper -log-level=debug -node=${internal-lb-dns}:2181\n      -interval=60\n\n      ExecStop=-/usr/bin/pkill confd'\n    enable: true\n  - name: install-awscli.service\n    command: start\n    content: '[Unit]\n\n      Description=download and install aws-cli\n\n      After=multi-user.target\n\n      Wants=multi-user.target\n\n      [Service]\n\n      Type=oneshot\n\n      TimeoutStartSec=10\n\n      StandardOutput=journal+console\n\n      StandardError=journal+console\n\n      ExecStart=/opt/mesosphere/bin/pip install awscli\n\n      '\n    enable: true\n  - name: filebeat.service\n    command: start\n    content: '[Unit]\n\n      Description=Filebeat\n\n      Documentation=filebeat systemctl\n\n      Wants=network-online.target\n\n      After=network-online.target\n\n\n      [Service]\n\n      ExecStart=/home/core/filebeat-1.2.1-x86_64/filebeat -c /home/core/filebeat-1.2.1-x86_64/filebeat.yml\n\n      Restart=always'\n    enable: true\n  - name: nrpe.service\n    command: start\n    content: '[Unit]\n\n      Description=nrpe for alerts\n\n      Requires=docker.service\n\n      After=docker.service\n\n      [Service]\n\n      User=core\n\n      TimeoutStartSec=15\n\n      ExecStartPre=-/usr/bin/docker pull mabitt/nrpe-server\n\n      ExecStart=/usr/bin/docker run --detach=false --name nrpe-server -p 5666:5666\n      -e \"NAGIOS_SERVER=${alerts-server}\" mabitt/nrpe-server\n\n      ExecStop=-/usr/bin/docker stop -t nrpe-server; /usr/bin/docker rm -f nrpe-server'\n    enable: true\n  - name: backup.service\n    content: '[Unit]\n\n      Description=Backup of cassandra database\n\n      After=multi-user.target\n\n      Wants=multi-user.target\n\n      [Service]\n\n      Type=oneshot\n\n      Environment=\"PATH=/opt/mesosphere/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/opt/bin\"\n\n      ExecStart=/home/core/cassandra-backup/backup-witan.sh\n\n      '\n  - name: backup.timer\n    command: start\n    content: '[Unit]\n\n      Description=Run backup.service once a day at 5am\n\n\n      [Timer]\n\n      OnCalendar=*-*-* 05:00:00\n\n      Unit=backup.service\n\n\n      [Install]\n\n      WantedBy=timers.target\n\n      '\n  update:\n    reboot-strategy: 'off'\nwrite_files:\n- path: /etc/mesosphere/setup-packages/dcos-provider-aws--setup/pkginfo.json\n  content: '{}\n\n    '\n- path: /etc/mesosphere/setup-packages/dcos-provider-aws--setup/etc/cloudenv\n  content: 'AWS_REGION=${aws-region}\n\n    AWS_STACK_ID=${cluster-id}\n\n    AWS_STACK_NAME=${cluster-name}\n\n    AWS_IAM_MASTER_ROLE_NAME=${master-role}\n\n    AWS_IAM_SLAVE_ROLE_NAME=${slave-role}\n\n    AWS_ACCESS_KEY_ID=${aws-access-key}\n\n    AWS_SECRET_ACCESS_KEY=${aws-secret-access-key}\n\n    ZOOKEEPER_CLUSTER_SIZE=${number-of-masters}\n\n    '\n- path: /etc/mesosphere/setup-packages/dcos-provider-aws--setup/etc/mesos-master-provider\n  content: 'MESOS_CLUSTER=${cluster-name}\n\n    '\n- path: /etc/mesosphere/setup-packages/dcos-provider-aws--setup/etc/exhibitor\n  content: 'EXHIBITOR_BACKEND=AWS_S3\n\n    AWS_REGION=${aws-region}\n\n    AWS_S3_BUCKET=${exhibitor-s3-bucket}\n\n    AWS_S3_PREFIX=${cluster-name}\n\n    '\n- path: /etc/mesosphere/setup-packages/dcos-provider-aws--setup/etc/exhibitor.properties\n  content: 'com.netflix.exhibitor.s3.access-key-id=${aws-access-key}\n\n    com.netflix.exhibitor.s3.access-secret-key=${aws-secret-access-key}\n\n    '\n- path: /etc/mesosphere/setup-packages/dcos-provider-aws--setup/etc/dns_config\n  content: 'MASTER_SOURCE=exhibitor\n\n    EXHIBITOR_ADDRESS=${internal-lb-dns}\n\n    RESOLVERS=${fallback-dns}\n\n    '\n- path: /etc/mesosphere/cluster-id\n  content: ${cluster-id}\n  permissions: '0644'\n- path: /etc/mesosphere/setup-flags/repository-url\n  content: 'https://downloads.mesosphere.com/dcos/stable\n\n    '\n  owner: root\n  permissions: 420\n- path: /etc/mesosphere/setup-flags/bootstrap-id\n  content: BOOTSTRAP_ID=18d094b1648521b017622180e3a8e05788a81e80\n  owner: root\n  permissions: 420\n- path: /etc/mesosphere/setup-flags/cluster-packages.json\n  content: '[\"dcos-config--setup_39bcd04b14a990a870cdff4543566e78d7507ba5\", \"dcos-metadata--setup_39bcd04b14a990a870cdff4543566e78d7507ba5\"]\n\n    '\n  owner: root\n  permissions: 420\n- path: /etc/systemd/journald.conf.d/dcos.conf\n  content: '[Journal]\n\n    MaxLevelConsole=warning\n\n    '\n  owner: root\n- path: /etc/systemd/journal-upload.conf\n  content: '[Upload]\n\n    URL=http://logstash.mastodonc.net:12201\n\n    '\n  owner: root\n- path: /etc/confd/conf.d/ssh-authorized-keys.toml\n  content: '[template]\n\n    src = \"ssh-authorized-keys.tmpl\"\n\n    dest = \"/home/core/.ssh/authorized_keys.d/extra-users\"\n\n    owner = \"core\"\n\n    mode=\"0600\"\n\n    keys = [\"/ssh/authorized-keys\"]\n\n    reload_cmd = \"/usr/bin/update-ssh-keys\"\n\n    '\n- path: /etc/confd/templates/ssh-authorized-keys.tmpl\n  content: '{{range getvs \"/ssh/authorized-keys/*\"}}{{.}}\n\n    {{end}}'\n- path: /etc/mesosphere/roles/slave\n  content: ''\n- path: /etc/mesosphere/roles/aws\n  content: ''\n- path: /home/core/cassandra-backup/backup-witan.sh\n  content: \"#!/bin/sh\\n\\n# necessary for java location\\nexport PATH=$PATH:/opt/mesosphere/bin\\n\\\n    CASSANDRA_DIR=$(ps -A -o command | grep CassandraDaemon | grep '/var/lib' | cut\\\n    \\ -d' ' -f1 | sed -e 's#/jre1.*##')\\nCASSANDRA_DATA_DIR=/var/lib/cassandra/data\\n\\\n    NODETOOL=$(find $CASSANDRA_DIR -name nodetool -type f -perm /u+x | grep bin/nodetool)\\n\\\n    AWS=$(find /opt/mesosphere -name aws -type f -perm /u+x | grep bin/aws)\\ndirectory=$($NODETOOL\\\n    \\ snapshot witan | awk '/directory/{print $3}')\\n\\n# We assume it's worked if\\\n    \\ it tells us the directory\\nif [ -z \\\"$${directory}\\\" ]; then\\n   echo \\\"Problem\\\n    \\ getting snapshot directory\\\"\\n   exit 1;\\nfi\\n\\n# We only want the snapshots\\\n    \\ dirs\\n# For filters rationale see http://docs.aws.amazon.com/cli/latest/reference/s3/index.html#use-of-exclude-and-include-filters\\n\\\n    sudo -u core $AWS --profile backup s3 sync --exclude '*' --include '*/snapshots/*'\\\n    \\ $${CASSANDRA_DATA_DIR} s3://witan-cassandra-backup/$(hostname)/ --region eu-central-1\\n\"\n  permissions: '0744'\n",
                            "vars.#": "15",
                            "vars.alerts-server": "alerts.sandpit-kixi.mesos",
                            "vars.aws-access-key": "AKIAIU6KU4KHLAG5KWLA",
                            "vars.aws-region": "eu-central-1",
                            "vars.aws-secret-access-key": "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",
                            "vars.cluster-id": "sandpit-staging",
                            "vars.cluster-name": "staging",
                            "vars.exhibitor-s3-bucket": "sandpit-staging-exhibitor-s3-bucket",
                            "vars.fallback-dns": "172.20.0.2",
                            "vars.influxdb-dns": "influxdb.sandpit-kixi.mesos",
                            "vars.internal-lb-dns": "internal-sandpit-staging-internal-lb-1023536621.eu-central-1.elb.amazonaws.com",
                            "vars.master-role": "sandpit-staging-master-role",
                            "vars.mesos-dns": "internal-sandpit-staging-internal-lb-1023536621.eu-central-1.elb.amazonaws.com",
                            "vars.number-of-masters": "3",
                            "vars.server-group": "sandpit-staging-slaves",
                            "vars.slave-role": "sandpit-staging-slave-role"
                        }
                    }
                },
                "terraform_remote_state.vpc": {
                    "type": "terraform_remote_state",
                    "primary": {
                        "id": "2016-05-12 11:37:52.531377229 +0000 UTC",
                        "attributes": {
                            "backend": "s3",
                            "config.#": "3",
                            "config.bucket": "terraboot",
                            "config.key": "vpc.tf",
                            "config.region": "eu-central-1",
                            "id": "2016-05-12 11:37:52.531377229 +0000 UTC",
                            "output.#": "10",
                            "output.private-dns-zone": "Z2GYVMHYIYQTQP",
                            "output.sg-all-servers": "sg-a327c4cb",
                            "output.sg-allow-ssh": "sg-a06e63c9",
                            "output.sg-sends-gelf": "sg-ad6e63c4",
                            "output.sg-sends-influx": "sg-213b2748",
                            "output.subnet-private-a-id": "subnet-6283d00b",
                            "output.subnet-private-b-id": "subnet-a85127d3",
                            "output.subnet-public-a-id": "subnet-6583d00c",
                            "output.subnet-public-b-id": "subnet-af5127d4",
                            "output.vpc-id": "vpc-3739425e"
                        }
                    }
                }
            }
        }
    ]
}
